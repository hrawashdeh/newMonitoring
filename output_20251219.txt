########## DIRECTORY TREE: /Volumes/Files/Projects/newLoader ##########
/Volumes/Files/Projects/newLoader
├── .DS_Store
├── .git
│   ├── COMMIT_EDITMSG
│   ├── FETCH_HEAD
│   ├── HEAD
│   ├── ORIG_HEAD
│   ├── config
│   ├── description
│   ├── hooks
│   │   ├── applypatch-msg.sample
│   │   ├── commit-msg.sample
│   │   ├── fsmonitor-watchman.sample
│   │   ├── post-update.sample
│   │   ├── pre-applypatch.sample
│   │   ├── pre-commit.sample
│   │   ├── pre-merge-commit.sample
│   │   ├── pre-push.sample
│   │   ├── pre-rebase.sample
│   │   ├── pre-receive.sample
│   │   ├── prepare-commit-msg.sample
│   │   ├── push-to-checkout.sample
│   │   ├── sendemail-validate.sample
│   │   └── update.sample
│   ├── index
│   ├── info
│   │   └── exclude
│   ├── logs
│   │   ├── HEAD
│   │   └── refs
│   │       ├── heads
│   │       │   └── main
│   │       └── remotes
│   │           └── origin
│   │               └── main
│   ├── objects
│   │   ├── 02
│   │   │   └── d7862a8f8b0a59299250f5e9f696e94f0081f7
│   │   ├── 06
│   │   │   └── 516624a4f389a2a0dd464b3c26c29cbebdffed
│   │   ├── 0a
│   │   │   └── d4c0459911a0e627a283718e36300516a33182
│   │   ├── 0c
│   │   │   └── 85bfd6d2f4e44467de713b827e43dab32d5d99
│   │   ├── 13
│   │   │   ├── 05e90c2b1f27667e4506cf26c6905e2ab75120
│   │   │   └── b64c93e83c69951ff0ec89878bd9f8d52c00ac
│   │   ├── 14
│   │   │   └── 6dd0769e441e9e19429d589d5244a491162c51
│   │   ├── 3e
│   │   │   └── 23b48f48283c58872066168b03d668758798e3
│   │   ├── 3f
│   │   │   └── 3a0c3609e59621270f377fcbd2966085f8e74d
│   │   ├── 4b
│   │   │   └── 53b3b07ff98d22556a6dfa43b86cbfbe622c3f
│   │   ├── 5e
│   │   │   └── 2711002013ebc49221514539d3679aec7b4a48
│   │   ├── 6d
│   │   │   └── e676a8c5112ad8d91e90bd5551d4a60428b04a
│   │   ├── 72
│   │   │   └── d184e6e35c57e90bc2686347fdc79db8401c91
│   │   ├── 8c
│   │   │   └── ff732b12186cdb983bff94d0dc2964fe1479a5
│   │   ├── 8f
│   │   │   ├── 262bf1327abd1c6aac506dc86f81b7bc8c0ce7
│   │   │   └── d2ca76a5bbf8fcf9356f1ee8b342a354f5d77f
│   │   ├── 94
│   │   │   └── e75796819ace6e7cca726dfd44ca2055d8406e
│   │   ├── 95
│   │   │   └── c628205bfaa29df3a39a4ffad7757621860cd3
│   │   ├── 98
│   │   │   └── 7fd3656ae124cb709563a90e3ede5d27312626
│   │   ├── a8
│   │   │   └── c75d100da7f5f90e03fe48970b5f3845f25b30
│   │   ├── ac
│   │   │   └── c75a2852288d313696636d9888dcbb2cc741a8
│   │   ├── b0
│   │   │   └── 34fd77deeaec913e0b411e8cb8d486b86d1c9b
│   │   ├── b4
│   │   │   └── c5c9fad9677fc946c2908e423a9a5c1fc1ce14
│   │   ├── b5
│   │   │   └── ef479dacfbe63302ffb1b67cbb6af4e42ed14c
│   │   ├── b9
│   │   │   └── ac84ab6fb51d7843ee2d85f94126793aae8f82
│   │   ├── bd
│   │   │   └── 5ca93ee8f0d27d6a46d9dd07c2227a7f74f156
│   │   ├── c9
│   │   │   └── 9330ab608924015cdc20a68f43d7a38293392f
│   │   ├── cb
│   │   │   └── 442292b94c6784f9df7008570e4b4c555d1a8f
│   │   ├── ce
│   │   │   └── c908ed0860d2653dc91064e13bffd5949f7d8f
│   │   ├── e1
│   │   │   └── e3bdce211591f92d1d277bf4a8ebc23e9f2c7b
│   │   ├── e7
│   │   │   └── d8479ed075ebf28028d9fe837619b8ea8c06a5
│   │   ├── ec
│   │   │   └── 37a138ad3df1cbbe6c123e48980c08dd1c92a4
│   │   ├── f8
│   │   │   └── 3c36d3f4ba2c7e0ca1bdb357ca28507d5e8347
│   │   ├── info
│   │   └── pack
│   └── refs
│       ├── heads
│       │   └── main
│       ├── remotes
│       │   └── origin
│       │       └── main
│       └── tags
├── .gitignore
├── .idea
│   ├── .gitignore
│   ├── compiler.xml
│   ├── encodings.xml
│   ├── jarRepositories.xml
│   ├── misc.xml
│   ├── modules.xml
│   ├── newLoader.iml
│   ├── stat.log
│   ├── vcs.xml
│   └── workspace.xml
├── README.md
├── app_installer.sh
├── infra
│   ├── .DS_Store
│   ├── local-path-storage.yaml
│   ├── mysql
│   │   ├── mysql-nodeport.yaml
│   │   └── mysql-statefulset.yaml
│   ├── postgress
│   │   ├── postgres-nodeport.yaml
│   │   └── values-postgresql.yaml
│   ├── prometheus
│   │   ├── AlertManager-nodeport.yaml
│   │   ├── Prometheus-nodeport.yaml
│   │   ├── grafana-nodeport.yaml
│   │   └── values-kps.yaml
│   ├── redis
│   │   ├── redis-nodeport.yaml
│   │   └── values-redis.yaml
│   ├── secrets
│   │   ├── local-path-storage.yaml
│   │   ├── monitoring-secrets-plain.yaml
│   │   └── monitoring-secrets-sealed.yaml
│   └── unistalKubeObjects.sh
├── infra_installer.sh
├── kube
│   ├── install.sh
│   └── unistall.sh
├── output_20251217.txt
├── output_20251219.txt
├── printProject.sh
└── services
    ├── .DS_Store
    ├── dataGenerator
    │   ├── .DS_Store
    │   ├── .idea
    │   │   ├── .gitignore
    │   │   ├── compiler.xml
    │   │   ├── encodings.xml
    │   │   ├── jarRepositories.xml
    │   │   ├── misc.xml
    │   │   ├── stat.log
    │   │   ├── vcs.xml
    │   │   └── workspace.xml
    │   ├── Dockerfile
    │   ├── k8s_manifist
    │   │   ├── .DS_Store
    │   │   └── data-generator-deployment.yaml
    │   ├── local-path-storage.yaml
    │   ├── pom.xml
    │   ├── src
    │   │   ├── .DS_Store
    │   │   └── main
    │   │       ├── .DS_Store
    │   │       ├── java
    │   │       │   └── com
    │   │       │       └── loader
    │   │       │           └── datagenerator
    │   │       │               ├── DataGeneratorApplication.java
    │   │       │               ├── model
    │   │       │               │   ├── ColumnConfig.java
    │   │       │               │   ├── DataGeneratorConfig.java
    │   │       │               │   ├── DowntimeConfig.java
    │   │       │               │   └── TableConfig.java
    │   │       │               ├── runner
    │   │       │               │   ├── ScheduledDataGenerator.java
    │   │       │               │   └── SchemaInitializer.java
    │   │       │               └── service
    │   │       │                   └── DataGeneratorService.java
    │   │       └── resources
    │   │           ├── .DS_Store
    │   │           ├── application.yaml
    │   │           └── data-generator-config.yaml
    │   └── target
    │       ├── classes
    │       │   ├── META-INF
    │       │   │   └── spring-configuration-metadata.json
    │       │   ├── application.yaml
    │       │   ├── com
    │       │   │   └── loader
    │       │   │       └── datagenerator
    │       │   │           ├── DataGeneratorApplication.class
    │       │   │           ├── model
    │       │   │           │   ├── ColumnConfig$ColumnType.class
    │       │   │           │   ├── ColumnConfig.class
    │       │   │           │   ├── DataGeneratorConfig$MysqlConfig.class
    │       │   │           │   ├── DataGeneratorConfig.class
    │       │   │           │   ├── DowntimeConfig.class
    │       │   │           │   ├── TableConfig$RecordRateConfig.class
    │       │   │           │   └── TableConfig.class
    │       │   │           ├── runner
    │       │   │           │   ├── ScheduledDataGenerator.class
    │       │   │           │   ├── SchemaInitializer$1.class
    │       │   │           │   └── SchemaInitializer.class
    │       │   │           └── service
    │       │   │               ├── DataGeneratorService$1.class
    │       │   │               └── DataGeneratorService.class
    │       │   └── data-generator-config.yaml
    │       ├── data-generator-0.0.1-SNAPSHOT.jar
    │       ├── data-generator-0.0.1-SNAPSHOT.jar.original
    │       ├── generated-sources
    │       │   └── annotations
    │       ├── maven-archiver
    │       │   └── pom.properties
    │       └── maven-status
    │           └── maven-compiler-plugin
    │               └── compile
    │                   └── default-compile
    │                       ├── createdFiles.lst
    │                       └── inputFiles.lst
    └── secrets
        ├── app-secrets-plain.yaml
        └── app-secrets-sealed.yaml

87 directories, 147 files

########## FILE CONTENTS ##########

# app_installer.sh
<<<<<<< Local Changes
  #!/bin/bash

||||||| Old File
# ===================== Colors =====================
BLUE='\033[0;34m'
=======
#!/bin/bash
>>>>>>> External Changes
# ===================== Colors =====================
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
GREEN='\033[0;32m'
RED='\033[0;31m'
NC='\033[0m'   # No Color
SCRIPT_START_EPOCH="$(date +%s)"
SCRIPT_START_STR="$(date +"%Y-%m-%d %H:%M:%S")"

# ===================== Log Helpers =====================
log_info()  { printf "${BLUE}[INFO] %s\n ${NC}" "$*"; }
log_debug() { printf "${YELLOW}[DEBUG] %s\n ${NC}" "$*"; }
log_error() { printf "${RED}[ERROR] %s\n ${NC}" "$*"; }
log_warn() { printf "${YELLOW}[WARN] %s\n ${NC}" "$*"; }
log_success() { printf "${GREEN}[SUCCESS] %s\n ${NC}" "$*"; }
log_section() { printf "\n\033[0;35m--- %s ---\033[0m\n\n" "$*"; }  # purple section
log_purple()  { printf "\033[0;35m%s\033[0m\n" "$*"; }
exit_error() { log_error "$*"; exit 1; }

# ===================== Prompt Helper =====================
prompt_choice() {
  local message="$1"
  local options_str="$2"

  IFS='/' read -ra OPTIONS <<< "$options_str"
  local DEFAULT="${OPTIONS[0]}"

  while true; do
    printf "${GREEN}%s (%s): ${NC}" "$message" "$options_str"
    read -r CONFIRM < /dev/tty
    CONFIRM=${CONFIRM:-$DEFAULT}

    for opt in "${OPTIONS[@]}"; do
      if [[ "$CONFIRM" == "$opt" ]]; then
        return 0
      fi
    done

    log_error "Invalid option. Allowed values: ${options_str}"
  done
}


# ===================== Configuration =====================
log_section "Verify Configuration"
PROJECT_ROOT="/Volumes/Files/Projects/newLoader"
SEALED_NS="sealed-secrets"
A_NAMESPACE="monitoring-app"
k_context="docker-desktop"

log_info "Switching to project root"
log_info "Please verify the parameters below before proceeding"

log_debug "PROJECT_ROOT = ${PROJECT_ROOT}"
log_debug "SEALED_NS    = ${SEALED_NS}"
log_debug "NAMESPACE    = ${A_NAMESPACE}"
log_debug "k_context    = ${k_context}"

prompt_choice "Is this valid configuration?" "Y/n"
[[ "$CONFIRM" =~ ^[Yy]$ ]] || exit_error "Aborted by user"

# ===================== kubectl Context =====================
log_section "Switch kubectl context"
if ! kubectl config use-context "${k_context}"; then
    exit_error "Failed to switch kubectl context to '${k_context}'"
fi

log_info "Current kubectl context: $(kubectl config current-context)"

prompt_choice "Is this valid context?" "Y/n"
[[ "$CONFIRM" =~ ^[Yy]$ ]] || exit_error "Aborted by user"

# ===================== Namespaces =====================
log_section "Creating namespaces"

kubectl delete namespace monitoring-app --ignore-not-found

kubectl create namespace "${A_NAMESPACE}" --dry-run=client -o yaml | kubectl apply -f -

log_info "Current Kubernetes namespaces:"
kubectl get namespaces
<<<<<<< Old File
   exit_error "Namespace '${ns}' was not created successfully"
=======
   exit_error "Namespace '${A_NAMESPACE}' was not created successfully"
>>>>>>> External Changes
if ! kubectl get namespace "${A_NAMESPACE}" >/dev/null 2>&1; then
   exit_error "Namespace '${A_NAMESPACE}' was not created successfully"
fi


log_info "Namespaces validated successfully"


# ===================== Selaed secret  =====================
cd "${PROJECT_ROOT}/services/secrets" 

log_section "installing Sealed Secrets "

kubeseal \
  --controller-name=sealed-secrets \
  --controller-namespace=${SEALED_NS} \
  --namespace ${A_NAMESPACE} \
  --format yaml \
  < app-secrets-plain.yaml \
  > app-secrets-sealed.yaml

kubectl apply -f app-secrets-sealed.yaml



# ===================== Comomon functions ==================

validate_deployment() {
    local deployment=$1
    local namespace=$2
    if ! kubectl get deployment "$deployment" -n "$namespace" &>/dev/null; then
        log_error "Deployment '$deployment' not found in namespace '$namespace'"
        return 1
    fi
    return 0
}


monitor_pod_health() {
    local deployment=$1
    local namespace=$2
    local timeout=${3:-300}
    local elapsed=0
    local interval=10

    log_info "Monitoring pod health for deployment: $deployment"
    log_info "Timeout: ${timeout}s | Check interval: ${interval}s"
    echo

    while [ $elapsed -lt $timeout ]; do
        local ready_replicas=$(kubectl get deployment "$deployment" -n "$namespace" \
            -o jsonpath='{.status.readyReplicas}' 2>/dev/null || echo "0")
        local desired_replicas=$(kubectl get deployment "$deployment" -n "$namespace" \
            -o jsonpath='{.spec.replicas}' 2>/dev/null || echo "0")

        echo -ne "\r${BLUE}[$(date +%H:%M:%S)]${NC} Ready: $ready_replicas/$desired_replicas pods"

        if [ "$ready_replicas" -eq "$desired_replicas" ] && [ "$ready_replicas" != "0" ]; then
            echo
            log_success "All pods are ready ($ready_replicas/$desired_replicas)"
            return 0
        fi

        sleep $interval
        elapsed=$((elapsed + interval))
    done

    echo
    log_error "Timeout: Pods did not become ready within ${timeout}s"

    # Show pod status for debugging
    echo
    log_error "Current pod status:"
    kubectl get pods -n "$namespace" -l "app=$deployment" --no-headers

    return 1
}

get_pod_status() {
    local deployment=$1
    local namespace=$2

    if ! validate_deployment "$deployment" "$namespace"; then
        echo "NOT_FOUND"
        return 1
    fi

    local ready_replicas=$(kubectl get deployment "$deployment" -n "$namespace" \
        -o jsonpath='{.status.readyReplicas}' 2>/dev/null || echo "0")
    local desired_replicas=$(kubectl get deployment "$deployment" -n "$namespace" \
        -o jsonpath='{.spec.replicas}' 2>/dev/null || echo "0")

    if [ "$ready_replicas" -eq "$desired_replicas" ] && [ "$ready_replicas" != "0" ]; then
        echo "HEALTHY"
    elif [ "$ready_replicas" -eq "0" ]; then
        echo "UNAVAILABLE"
    else
        echo "DEGRADED"
    fi
}

scan_pod_logs() {
    local deployment=$1
    local namespace=$2
    local tail_lines=${3:-100}

    log_info "Scanning logs for deployment: $deployment"

    # Get all pods for this deployment
    local pods=$(kubectl get pods -n "$namespace" -l "app=$deployment" \
        -o jsonpath='{.items[*].metadata.name}' 2>/dev/null)

    if [ -z "$pods" ]; then
        log_error "No pods found for deployment: $deployment"
        return 0
    fi

    local error_count=0
    local warn_count=0

    for pod in $pods; do
        echo
        log_section "Pod: $pod"

        # Check for errors
        local errors=$(kubectl logs "$pod" -n "$namespace" --tail="$tail_lines" 2>/dev/null | \
            grep -iE "error|exception|fatal|failed" || true)

        if [ -n "$errors" ]; then
            error_count=$((error_count + 1))
            log_error "Errors found in pod logs:"
            echo "$errors" | tail -10
            echo
        fi

        # Check for warnings
        local warnings=$(kubectl logs "$pod" -n "$namespace" --tail="$tail_lines" 2>/dev/null | \
            grep -iE "warn|warning" || true)

        if [ -n "$warnings" ]; then
            warn_count=$((warn_count + 1))
            log_error "Warnings found in pod logs:"
            echo "$warnings" | tail -5
            echo
        fi
    done

    # Summary
    echo
    if [ $error_count -eq 0 ] && [ $warn_count -eq 0 ]; then
        log_success "No errors or warnings found in logs"
    else
        [ $error_count -gt 0 ] && log_error "Found errors in $error_count pod(s)"
        [ $warn_count -gt 0 ] && log_error "Found warnings in $warn_count pod(s)"
    fi

    return 0
}

check_health_probe() {
    local service=$1
    local namespace=$2
    local port=${3:-8080}
    local path=${4:-/actuator/health}

    log_info "Checking health probe: $service:$port$path"

    # Port-forward in background
    local local_port=$((8000 + RANDOM % 1000))
    kubectl port-forward -n "$namespace" "svc/$service" "$local_port:$port" &>/dev/null &
    local pf_pid=$!

    # Wait for port-forward to establish
    sleep 2

    # Call health endpoint
    local response=$(curl -s -w "\n%{http_code}" "http://localhost:$local_port$path" 2>/dev/null || echo "FAILED")
    local http_code=$(echo "$response" | tail -1)
    local body=$(echo "$response" | head -n -1)

    # Kill port-forward
    kill $pf_pid 2>/dev/null || true

    # Evaluate response
    if [ "$http_code" = "200" ]; then
        log_success "Health probe OK (HTTP $http_code)"
        echo "$body" | jq '.' 2>/dev/null || echo "$body"
        return 0
    else
        log_error "Health probe FAILED (HTTP $http_code)"
        echo "$body"
        return 1
    fi
}

# Check all actuator endpoints
# Usage: check_actuator_endpoints <service-name> <namespace> <port>
check_actuator_endpoints() {
    local service=$1
    local namespace=$2
    local port=${3:-8080}

    log_section "Actuator Endpoints: $service"

    local endpoints=("health" "info" "metrics")

    for endpoint in "${endpoints[@]}"; do
        echo
        log_info "Endpoint: /actuator/$endpoint"
        check_health_probe "$service" "$namespace" "$port" "/actuator/$endpoint"
    done
}


# ===================== DATA Generator =====================	
cd "${PROJECT_ROOT}/services/dataGenerator"

SERVICE_NAME="data-generator"

log_section "Installing data-generator Service"

log_info "Running Maven build..."

if ! mvn clean package -Dmaven.test.skip=true; then
    log_error "Maven build failed"
    exit 1
fi

log_success "Maven build completed"


log_info "Building Docker image with tag: data-generator:0.0.1-SNAPSHOT"


if ! docker build -t data-generator:0.0.1-SNAPSHOT .; then
    log_error "Docker image build failed"
    exit 1
else
	if docker images data-generator:0.0.1-SNAPSHOT --format "{{.Repository}}:{{.Tag}}" | grep -q "data-generator:0.0.1-SNAPSHOT"; then
	    log_success "Image verified in local Docker registry"
	else
	    log_error "Image not found in local Docker registry!"
	    exit 1
	fi
	log_success "Build completed: data-generator:0.0.1-SNAPSHOT"
fi

if ! kubectl apply -f "./k8s_manifist/data-generator-deployment.yaml" -n "${A_NAMESPACE}"; then
	log_error "Deployment manifest failed"
	exit 1
else
	log_success "Deployment manifest applied"
fi

# Monitor health
<<<<<<< Local Changes
monitor_pod_health "$SERVICE_NAME" "$A_NAMESPACE" 60
||||||| Old File
# check pos sttaus
=======
monitor_pod_health "$SERVICE_NAME" "$A_NAMESPACE" 120
>>>>>>> External Changes

# check pod status
POD_STATUS=$(get_pod_status "$SERVICE_NAME" "$A_NAMESPACE")
log_info "Pod Status: $POD_STATUS" 
# Check logs for errors
scan_pod_logs "$SERVICE_NAME" "$A_NAMESPACE" 60

# Test health probes
check_actuator_endpoints "$SERVICE_NAME" "$A_NAMESPACE" 8080

log_success "data-generator service installed successfully"





######################################################################################################################################################
#### end of file app_installer.sh ####
#### end of file app_installer.sh ####

# infra/.DS_Store
[SKIPPED: non-text or binary file]
######################################################################################################################################################
#### end of file .DS_Store ####
#### end of file .DS_Store ####

# infra/redis/redis-nodeport.yaml
apiVersion: v1
kind: Service
metadata:
  name: redis-nodeport
  namespace: monitoring-infra
  labels:
    app.kubernetes.io/name: redis
    app.kubernetes.io/instance: redis
    app.kubernetes.io/component: master
    app.kubernetes.io/part-of: monitoring-infra
spec:
  type: NodePort
  selector:
    app.kubernetes.io/name: redis
    app.kubernetes.io/instance: redis
    app.kubernetes.io/component: master
  ports:
    - name: redis
      protocol: TCP
      port: 6379
      targetPort: 6379
      nodePort: 30379

######################################################################################################################################################
#### end of file redis-nodeport.yaml ####
#### end of file redis-nodeport.yaml ####

# infra/redis/values-redis.yaml
auth:
  enabled: true
  existingSecret: infra-secrets
  existingSecretPasswordKey: redis-password

master:
  persistence:
    enabled: true
    size: 5Gi

replica:
  replicaCount: 0


######################################################################################################################################################
#### end of file values-redis.yaml ####
#### end of file values-redis.yaml ####

# infra/secrets/monitoring-secrets-plain.yaml
apiVersion: v1
kind: Secret
metadata:
  name: infra-secrets
  namespace: monitoring-infra
type: Opaque
stringData:
  # PostgreSQL (Bitnami chart keys + helper vars)
  postgres-admin-password: "HaAirK101348qAdmin"
  postgres-app-password: "HaAirK101348App"

  # MySQL (Bitnami chart keys + helper vars)
  mysql-root-password: "HaAirK101348qRoot"
  mysql-password: "HaAirK101348qAppD"
  MYSQL_APP_USER: "test_user"
  MYSQL_APP_DB: "test_data"

  #REDIS Keys
  redis-password: "HaAirK101348qRed"
  REDIS_PORT: "6379"

  #Grafana Keys
  GRAFANA_ADMIN_USER: "admin"
  GRAFANA_ADMIN_PASSWORD: "HaAirK101348qGrf"

  # Alertmanager (optional auth, future-proof)
  ALERTMANAGER_BASIC_AUTH_USER: "alertmanager"
  ALERTMANAGER_BASIC_AUTH_PASSWORD: "HaAirK101348qAmgr"

######################################################################################################################################################
#### end of file monitoring-secrets-plain.yaml ####
#### end of file monitoring-secrets-plain.yaml ####

# infra/secrets/local-path-storage.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: local-path-storage

---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: local-path-provisioner-service-account
  namespace: local-path-storage

---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: local-path-provisioner-role
  namespace: local-path-storage
rules:
  - apiGroups: [""]
    resources: ["pods"]
    verbs: ["get", "list", "watch", "create", "patch", "update", "delete"]

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: local-path-provisioner-role
rules:
  - apiGroups: [""]
    resources: ["nodes", "persistentvolumeclaims", "configmaps", "pods", "pods/log"]
    verbs: ["get", "list", "watch"]
  - apiGroups: [""]
    resources: ["persistentvolumes"]
    verbs: ["get", "list", "watch", "create", "patch", "update", "delete"]
  - apiGroups: [""]
    resources: ["events"]
    verbs: ["create", "patch"]
  - apiGroups: ["storage.k8s.io"]
    resources: ["storageclasses"]
    verbs: ["get", "list", "watch"]

---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: local-path-provisioner-bind
  namespace: local-path-storage
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: local-path-provisioner-role
subjects:
  - kind: ServiceAccount
    name: local-path-provisioner-service-account
    namespace: local-path-storage

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: local-path-provisioner-bind
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: local-path-provisioner-role
subjects:
  - kind: ServiceAccount
    name: local-path-provisioner-service-account
    namespace: local-path-storage

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: local-path-provisioner
  namespace: local-path-storage
spec:
  replicas: 1
  selector:
    matchLabels:
      app: local-path-provisioner
  template:
    metadata:
      labels:
        app: local-path-provisioner
    spec:
      serviceAccountName: local-path-provisioner-service-account
      containers:
        - name: local-path-provisioner
          image: rancher/local-path-provisioner:v0.0.32
          imagePullPolicy: IfNotPresent
          command:
            - local-path-provisioner
            - --debug
            - start
            - --config
            - /etc/config/config.json
          volumeMounts:
            - name: config-volume
              mountPath: /etc/config/
          env:
            - name: POD_NAMESPACE
              valueFrom:
                fieldRef:
                  fieldPath: metadata.namespace
            - name: CONFIG_MOUNT_PATH
              value: /etc/config/
      volumes:
        - name: config-volume
          configMap:
            name: local-path-config

---
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: local-path
provisioner: rancher.io/local-path
volumeBindingMode: WaitForFirstConsumer
reclaimPolicy: Delete

---
kind: ConfigMap
apiVersion: v1
metadata:
  name: local-path-config
  namespace: local-path-storage
data:
  config.json: |-
    {
            "nodePathMap":[
            {
                    "node":"DEFAULT_PATH_FOR_NON_LISTED_NODES",
                    "paths":["/opt/local-path-provisioner"]
            }
            ]
    }
  setup: |-
    #!/bin/sh
    set -eu
    mkdir -m 0777 -p "$VOL_DIR"
  teardown: |-
    #!/bin/sh
    set -eu
    rm -rf "$VOL_DIR"
  helperPod.yaml: |-
    apiVersion: v1
    kind: Pod
    metadata:
      name: helper-pod
    spec:
      priorityClassName: system-node-critical
      tolerations:
        - key: node.kubernetes.io/disk-pressure
          operator: Exists
          effect: NoSchedule
      containers:
      - name: helper-pod
        image: busybox
        imagePullPolicy: IfNotPresent

######################################################################################################################################################
#### end of file local-path-storage.yaml ####
#### end of file local-path-storage.yaml ####

# infra/secrets/monitoring-secrets-sealed.yaml
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  creationTimestamp: null
  name: infra-secrets
  namespace: monitoring-infra
spec:
  encryptedData:
    ALERTMANAGER_BASIC_AUTH_PASSWORD: AgBLFtB8TcYsStlOF53UcC5F898tBMhB04hcGCISwF5blROYJmcB9kookE0AN5dD5SUHpwtwa4fnxiv5p5PNCglOBv3m2dUcjfAaeB4t5c5gXKIqsAc8ZO2Z5rIhcsmn+GJPvPyu7qiZ+P3wedTjFgBYpHwVT/TcZwDX5Zc73vqI2dF/ektcdckBodK03l+e3s94dN51EtprxxxOQR2ASOvKtWDOfpOBH1xux6EdUD2txXFIg9QTQnrMHzPyt1P5GL88kW0m/Dr0cY/iLY/pvyiWDlJaVj9x5ERjEJVyXtdmA0zPZd3+riCj8Glt6OEPmpbYiUiMJDWJSGCDlLq/tSmNIpfmcEZ1iDVkj25P2k7Ghp8IgB1mwckratiVpAUFYotpq5Pa2rRf87+DBPOBdc9DTtBTyAP7FMffQXwXKrzkE5CLw8eJVldH7hLoEA7/psUcwzswxrbR47m2rGu5MfArBD7nVvT5BlKBouor2VQjjoND8xe9YGmZM+YIJyvVgRJe2iZswlFSp9qkDF9bVN2HMGAypUfQu5xCpk3MhwO4x0XB35yDL6gqBKX2244QVvhYQuM13dmeWeHKoGRs9RgXxK6LH8qgf32mFXhcERZvw6sK3wzKMYUPVtqY+jxwi5+dcZvlRnzLg4vt0nBm2gpSwaM4EZmWRutbVEnIsGiCUwbY8SBp6e+doD4MrM0Qa270ITLHsTuVS22NaMYqadSjpg==
    ALERTMANAGER_BASIC_AUTH_USER: AgA0deDpJl02UXllD2CA65ClGR0AMbmpwOKdajdYZ55iCdps9y8SyULV5P11GwGt/TJ+osdNTkbo6hATAFnCOEklBBWbJF0QQV7D3eHS05pLBpTuzLqBP6jH59+JyC6nXpyi2F4mdLBd41DazOb0J7pFmleEJlJKBJspaPExnRnfulz3CkBdsIoBqblWQafxcgsV/SW9Egfo5AtbMlYaI9By0WpWZl8kIod8Z0/TZDY3Eg/uEMXMvZmiTPnLiSnVEqixXaqrV6U0Q5bkx0lV2OKDScgvliYBxQYkM5WDZSu1PfxFGvrqqdDAeWuXaz3r8ps1Spi1oMTLWaOgbYZr5Nz1GX/7hD5M2olO4THNec9q8OPhq8CUCzZEBpPBYvr9A+9KczSh3lCUYr9+WAxnuvzfXAVJAktNVBp9MlKxDnGQY7lWbg/glkC/eNikzBpZU67L/ac4WbN1KtSLC5Sh5A0ebXmAUzNpMnmA2MJxuB2X1gbau2YkAlhTGxhIvFq0TWj1PEM3f2+YBPiYeQzdgbw82C5SUzBFNCYlnyBa2kvI7OAN/t++YnoTbRVZhcR/sLCJJkmpSUb9LFQiznv0IJFlQue/rUbVFOPTVgqAppFQk7A0+GsA+y1FgCszFYq43eDwZUzuYiZZyOVRks/Ao7lBPPTs6E1gZVEGYOv6rH9Rq+JIG3/WPIM+EV4y2g4ULnJSfJPk0e8ZsVbmamM=
    GRAFANA_ADMIN_PASSWORD: AgAsFtNN+aSNZhk88jNM/mI8Lum0KiMw5nGwt5HXToxJdoc2x+cuo5Mei3t+cTJ6tREizWTBOnNvAGEie3eXEKvu01OBZNveklKSnDzo5DqvSB1u4lDhv+IcOBoHQ0IG/TJC6v1Dj4nApZQEgj3O7yF6q6MOdoxDS/BpqmZ8o1O/KO+BghtysApKN2kptzRHyVuNyLukhTlOzFvhPksBNk/Jsq3VfossQ4tHXC9cYVyH0uduiFt0teUTCy9NjUfiIZvt61uQPrAmlYFg94RrQH8LmKSHrBykNrYk0Dj5JSwR6z3xTuRhRJDkKi95mBAwQ8icGNfjP3tXnZdAlq9cn+Z9nHQWq4433fKrSWcrOdhQaNrgNEO1IqIiB9HlRxwSLz67zoxcCfNy6xU9qjKaDgMlrs6GqXXTEvYwkKz4AoBIowmeu1VCMpDRjFIwGSvqeFSxa5muVszyyjiCWwGe0NCTKMLCNA+KxVcuI5zcOYSZOec2AQx3nHt0xhmTL58/0p6g5xXdRapUd7zLJtaScihSDY0yVPyQVvjtFY6kCsn2YeAepihTg24rKBaqshJSdrUygXTWnftAvUbDJXQsFFzGfWgZGSSij+2dgZYPEfQ3EFkV2mGocAPbenGJXbvTqonAq63EAB06WnNJUDj0TPyWGEM6sBGCR+25Mvx4eRxmW+C166wSDwpGYwYmrCU1a14pdp6EVXkyJ0RPmqVARkRE
    GRAFANA_ADMIN_USER: AgAAVoevLhufB83YSVode3e7RYMy89KSQR6fCpHYoQW2ssoSU9WmqwsVjRqlECu0BzR0k1Q2KMOXaCZ2zraKnXX6ebvdpmvXDJd7QMpydfT3F134L+G6igoVVsaKY+uU8eHsVK05X48bzMzNdXRZCB94OjE2zrzel5p+4Un5ZW4nSTM0Ekpw3Ujq90syMDXanVuZQ4vIJ6DS8GFR6m/+PNQkccngww4BEQbmuzDvLEQ7K2RTQJ9syUrBvWSXVeihMKeCwwLQnoH7WeOA9afzY7pfmcFSb0IEv2xMW2tJVqY1+fAq3VN9zZqSwbgL44wa9z7rL139LVg/pGYTENjHi7wV0DS8XXYwPMMnhHc2H61Oy437QmA6OIvjWnubviqTb5/6Ric/T2SndC1fZSWQpSxeBSooRWX8WysGfdEWBz3xm4xmN5H3A2VjHvEHDMYkMY+KK1QHBfwHzZIWlfkIlbi6CcwCUNntdkY+BzxxsgeqU1kANe7PgZug0kBhzTtMFu7D3x4UFSZmxiyW0Dt2/cjnKwUPRnkywfEAHhLM2q0weeAluSBeCTZ7yXMSfkJyWJKK8nON9m/qMJ2yaxF1hx25xSjjILqnckB2JgkejUlQSaGWUX9VpveDEbwuOb9lZEpXo+MvCfk9l0F6fguFNMr4fqvNoLC3tTL+cy4BWc+JkW4OoB9MWRQYWNbIGmu6U0O80fGvAQ==
    MYSQL_APP_DB: AgBGIg5iW/DNbOOUVVzDFOOK1JT0xa/BIUCAt94Z9N19RvuCNCsBsENSysp8nLWCbrBS5IYSK3Wri/xZcze2ikfLETZvBfp3yJ2yaKBt+BdqhqyVqGtv18zLMmoABWgZ4gfmFCdLhAiBy2lx27YzLEndQXE5HGjceyrVVNUGTKXJMr5PK/nNR1/8JHAdFO19xR9eH6W8axjyBlrVTrK9M40u+iQpmDHFnZhPBBNRHGCg/E/WftGM4pnKPmtqkfcXDGptSfjAfLPvGg8IQcSfuR/D0tzIzN3auyksdxHLvtWLdSVKRn0GzgzMQwPWN1sBXqsV9FU1oaFcnefHo4NCmGRLYNKfef0N+qQxKjDa9qxMpdFVsz3/VSOV89ohweeSwJfnHmdOjNGpuxCdEA+Vr2EeJhA2lgPnJPb9DYdOfEViFfxZXXl5NngGxnz4vEbfwK3Uf+1VidgpaeXTtqLhWB4pw8DBiu32ZLocYWIANzyjBcB0p1XUcJ0oTKd9l7QZ/SaagFpry1ZqGGE0vfXJocPmoX8Ufdx4YfnbswSNA9G8dH/d9KRkvtNRomaUC+fsaoch2sMTcNXqHOEzcwCzLoBb1PNGEUhF2XdnbIBoA228/vqx1jGPDNTvSlGB/Khuylg4xFj2epVrLav/YbTVsEMordMg2pmNj+tYnMIUbX6DEZ22TngBJ8c2NQ6Ml5cRbeYQQDsbvR57erk=
    MYSQL_APP_USER: AgAxg//9dEzHF77YZpttJFxUwoaN4x3I1bmKcvcJSyavtj3H7uZU7zpvsQ0MujFFlAtryKTwcgAR8BC7kkddi0lnzNXotmgHu0v/lvaZqQIdxS6Kc0br7jclKcg2m1QjEnnPhLsw+4eUZ/baOZZPuDbhGYQoyAaJRURcYgT7c24u09GCY+PB68J9jw6eDsIcTyhKq6PBgNsndKT9fIn19hllM/pE37t+9sY738V5vaLlzQZ6MvWG11k4NBJDJKxbUdw2gfXLb9bCy67CDURsugsu9wO6TGpGU/6fqrldXrANWPINOQ6hCTn6MaGHF/MnP4M24aDoReFk6WoJW2uF8gpmz5kPeuI1H9DQ98tWVmYCu72lxgKRsCTrE/o6gT3mMqbYLz7PWAvO1DnvdAxLPmEJeWE3e10wxZXB+B3hrOXoQ4HWlWmIo/MvwOCqfAdPhXQwnLZojq4z21oZGvuwxWOKn/JYmEGuWjCqhUGBs3p7d6X1mazWQbSPSQ3tzmOJON3iQ+0PjBiv6Y5eEY/rjxQNgFb29oa8hvhMIUt0KuuBuZ3xVGtnBkng5ObTzRiRip4181+V7WYgAVa0PpYVtVDNqAgj20YSJ2AgJUioGK1Jyhz/sPQsHFA6ph9Gz9cv4UGP2WB4L5+0lf87eaDB6xtKOWz0QrjlBKOBhKQjVDOX+dRuFSOxsnIgTl+Fayhik2tKZAhggWt42S4=
    REDIS_PORT: AgAEfR64J/3LWkXJKl/c2EfTvuvo7wDHMzYa9x6WEj8S0vD4MCO4WZA3Ws4g6iAjSuRcCPBLDff1NpFMGdf1jy1eFGCgldCom5jEXRPmKXyrsjfCGa4CKk3GMy7VW41uGMPtNkR+P5cw3pNVsUbE9QlgiNxFOAoOSr9eR6coyiZE+g0QEyhBon3wmhry9DV3E+YBsrriT+ALxS9P9VWIX0qSw2vXm1yyGpnuJhYFhnKFzU8Y36YpLYbkkC2588swq/BHtfMYmGEJCk8Njo+KT7uXgk6MqHv74IbI27zSpiIx+XFaZY6qzklcQ+yLKzbtlL/iEyTVtvQoMbAtvPOjM2Yh7uhah3Z7dNMrSVvRmGLamar+dSOWfQpgHsgmJtwmbYOxbPotBra2uZuSOgsMbD1Smb6qsxV5ACQhDDx57hkTkNt6Yyr1Tj/mnhFP1WZqm5rM42Sons3SsNnDu+BfDYHS/GUnTAt4n/gHowx6BRHj0TDKw04eUylxJT40PipCh205OySgdgXr2LPqVLo3usdUqthbDQKTF7dQtXVtvcOvCE3uA8ohfXwELiX5GNGos7qzKWeXOFo71xtOuglQ6Orj2SyuuCFmx5LV1eZ1x5K9W+N4ksP/KnqVBe8z8fjQRUz7TbxdGRACd5W+z5RBViMsv0HkfJ8w8GrBnLgkMijM+fd3tmYsJnl8+E42HpeqyE7FcEW8
    mysql-password: AgC3RXASGjB93cYcaTvUkNM9N4j3DX5xEfThTfVcO9NjdXXLyJVhGhTO/FyOoQmzEzFcmWRzutwzf9coHlRHpdc2Kaua2FSsaS0TZiLX4eCEXS9r4uxttTsW5bEu2et/912q7R8qgYIImFG3alBZRAWhEoD/pUBKqik5/iqJJhAP3wQ6nB5V5L4rap88fBaKf+qFAlFzKq2Kkwf/vr538S8OjywvR4epA8gpE4yFkOZtsHfLCBO10p2lZxL/nmIpc+XlbsiGxSGifwve3Nr33oUnyKLb4AYhxhNPzqIOWVfSswdBWzCv5I6dCwfBU3O4vAtLnbTAPpr7YYYjQSGSSwrOjXgk5wEOBriFrK+DY1ihUNJ3aMQSft2/RTZSTTwQ/aIdRVPUbw7DPeOMmD6t/eh39JYvqB4OZuFkXOk0N1MTbuZsifUNODCbL50f3pC/UgTnjJl+i4Kha8ynwby98213gDqFpIlE9VsC4ec4kKrXhetbYXlXk6CfLOpGOZkXG3Cw0TFLHjNWn/re4Rw4LFP9XSaId2jWZEs7bCARIhlJfUD9djsFpXHrKFQN0o0OFn8HQ9lawHjyCRM44CvMGQn8L9nQpepI45cFSpT8uvBheP8N14Srz982Uiw0OOnu8LKIMhIo48iElcabENOmkKQNkatpiGuviCKNS6ZPPR+QXQfOSb6EoQuiJcH/6oA1EN7np/SLxOSatMCQUVvtyWtnoQ==
    mysql-root-password: AgAD5WzOaXOD0iXUVf50CtKoWDvkcLZRMVgFEA9tjzKP71y5vBpq02kfrDB+T5djiQWMteXhQ7S6TVYT67RNI7cuBrUM7chqgLNDjbdqLGGM71Pcst8X01xMpC7/dO7YfwpNDeQMTURz4I9nCYDDvUtQ+twtv8ZgJk7TnWcN8pgYtiMKujGQAvh9Y2gzzhAE7zqTrDpA2hzR1wh8UaRsEhQ7PxjFrIz0pSyJ8QUovLDp1ivYRVrEh7S0cYd1wV92HmuKcQrNCl3YtdZrDOr6vAcD/ucnib5TPrZGNPeV0CqHAcSXCQ6+rPALACd69mh8Vq/1o1eYrnkNiwAreVy5HkLeTNZULkjqgwMQ+/7ihplXpHD7stQXsasFfiCxen2le9tmoKnrt769wvHrLom2/qA+bInMkE8ocNXgy64bKL2ImDF3qGG7pNc9OeyKwVqvA1u3s76g9BQfhZkBb6SUVrPX4/kb5Xf//EJW/XP0O0jFabxdmFZ1ny4JEDFQkn4oPJlSWJuBiVo9iZrE1+aobdC8fe7oGllFu69HBuiD7Me62WPqB2MHEc5vdRuUN1+shJt4YjaiMYlC9UN5reoY15BYDCfssgbdRPgDGJzXymoGEg4dRi+4WEZ8EMPQTe68SEEEHFU9YgWfk3JZVjFzjwkpHdTg49JaeZO/zNILsrUc2d50PNoRZaWkvzb2lUfWXYScqdvePZOS4l5mX1l5Zkud9Q==
    postgres-admin-password: AgC67loCuP+vxAoDYRq7SKIZAUswKbzCFAgQyhSZ4IOltUCXUWVIBKF4olLrgHQjWph6sjFYb8+pJXhBgXRxdyrwVoxF1bBUa/O+WkcLRG6du42FQWpcaUeUVChO+eixp2k/Wpmo8+mbUEowvXWtVyQLK8dyB7HvjJMeIZEGZdwyc7CAlVxYPbumz5dPp4oD/XQ8C7ek5LXNYYYL9rnC3VhIkshJncJZ1LM9b3hj8og9FA2824ByYKArweqVx3IlYtYJZja1x/gyubo7LhGoqa1MCfduNxiCU6wIWxtOJXnDXNHqpW8sQcNUCHmhbFQ5VzTuaw/RCKh89eGSGtqk6OHW/2zT8tFwnuB6cWN+jbjUkL/xrnTYQhsCdunlZ8moH2Exjv/BU0dA0Gwv9DMi5cHAmEHgUtwhiSqzDrg16zs26O69qUPnyANaPj1WS16cGLakwuH+jZzYuFZZr4VQw3s6vM7VC6gR08+/DiXxJRdkpJdBkKFk8LgtRZrHYBuEpQfA0MdjgN6bFdICBFLhYc1D6M7ywjjX7apRW+mPlfr8c0hyjbedJ64D5lyCrirNyRyTBqUI2phj87B8RtizYeppTIqfAeYVFv60LcyIhE7VCkSwBRTiT48k1w7JIBwK5GMAaVx30/1BbQEMdYyaR5FBuGV1AKdkggkbvOlphrX/gP5Mmv1wYlVkrCrN8lAdvoCCyrU6gXzVFuh+vC+ppc5dpAk=
    postgres-app-password: AgDHqPBd5x3CxTDxZLYlKqSrEJajsT16WYTDwGv8Tcotm9K5HljH7O6F7lbT7Rw+TbVOpGByJfWbzb4idBDyjBPcd+4Gb1pahe8G9nDn3aO+QQ3NqkpaR52c8XZ5sdXXE0/zlz3sRgT80meITiAt73f7LNIcEDcf0K9KVNXKauRMOSpR9y/rK8nx4u+0NufDT6xqyQIQLlkvh/KolPDfwyK3MIwyZP6dlVrVA7xHhogfFJ0yTxKdPBL5mY0c8GCJblcDbRmrHGm6bUVbNAzzF2WYgu/gqV0p6HXpyS4odNtVL4VidETZlfzLx47trviRQUuADjrAiMWNrc80x9yvjYMpxXV3bpHUX8Ah9ROnYMKswkZGFYH5v/B1Tq+9F1s96lS0XkX6zEx56uITJloThSL4uxH34P9ZLx87hsBCilGlsq54lFNhOadCvanXQeGOCjxDuU/2XsJr3Vwd/31qOgPZIYvDAApoLrWa2IgH3qUe5Nk+EBqKMGwvBajSjx7NFdATSIcoitEGBZY9f0CGTEi9jEvagnt+TYkQeGemmUphjbXqssTOh7PzVc2utFsSkdkAJKV2y8B25v1CtXYSil+e/50iDfyCbWgmmVzTO7DVwlHpDsd8B93rnHoMosShUS5nxvF9CKZGsXOek1AD4k9UBZzksVljy5/QRasA/gZvQoyBlxFypYLl+NZYcpnqT9LYSK5983yjNgKwUXZe9IM=
    redis-password: AgAy3POQkRk8HyiD1AZ6jdh9IcoE5U6N0byfHveY9ochtM4KfBIoSQJw/2WDvEISg+MZ2TT2jGp9nE24mg/IOfhZbizZpBRfsSpEhKL4KcxjLEaXwcAO+qi4oBEA4rUvU25TspTzwzakfsWAa/4QG/giSh1qeHZRvmq587YKC4pdhQ5lBx8P1V95k39KgZNXqomc4xanZXZh3uB9o8DXqY3Cn/K80Vno+OkIn+9KNgwSaZehJMa3YHQZ1cq1R52Kx01EareE4o+j83R8XojLY/Y2a6JIpdXm2mnZ/BNyFMiiEjVtQ84kjs62xp0rWSn3yJ34gZr5YODyCCjNG5uwzpk+7Xny4EjhzVCEDW2k2o8SzKAla//5gwoZ45HRu2Zmcs77XH4MtczMzWwGD9F9WuQrCAEAlAzol6ubUiLPpdFn1bTjFZ57bfuIf4u5pDqyNfLpzoZ5rFtwIViXlXZ4OzyO2FN10xy+Kg3UQj3StukBPJ3gFTywlHILTDXwSUVTuf40TjB6HTp6CIsPyDsSh2RP4yt5S7hjVxo1YbMmCwGvMuzPOASEK1zj8x9IqDAzXLsKp6+KXf53/NRnS5raZl0YV2/ZEdIJBrnuc6Cpy/yQfdTmybgoJcUxVx8QoWetqdgMOZHjhk95bVF/oa+92BZDctB23C6VS7YE1SVsrAHdE+Qa6QhCIVKpPuqE6/5FDsifo08/rQdDrwO2bMJKPbJ4
  template:
    metadata:
      creationTimestamp: null
      name: infra-secrets
      namespace: monitoring-infra
    type: Opaque
---

######################################################################################################################################################
#### end of file monitoring-secrets-sealed.yaml ####
#### end of file monitoring-secrets-sealed.yaml ####

# infra/postgress/values-postgresql.yaml
auth:
  existingSecret: infra-secrets

  username: alerts_user
  database: alerts_db

  secretKeys:
    # These keys must exist in loader-secrets
    adminPasswordKey: postgres-admin-password
    userPasswordKey: postgres-app-password

primary:
  persistence:
    enabled: true
    size: 10Gi
    storageClass: local-path

######################################################################################################################################################
#### end of file values-postgresql.yaml ####
#### end of file values-postgresql.yaml ####

# infra/postgress/postgres-nodeport.yaml
apiVersion: v1
kind: Service
metadata:
  name: postgres-nodeport
  namespace: monitoring-infra
spec:
  type: NodePort
  selector:
    app.kubernetes.io/name: postgresql
    app.kubernetes.io/instance: postgres
    app.kubernetes.io/component: primary
  ports:
    - name: tcp-postgres
      port: 5432
      targetPort: 5432
      nodePort: 30432

######################################################################################################################################################
#### end of file postgres-nodeport.yaml ####
#### end of file postgres-nodeport.yaml ####

# infra/local-path-storage.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: local-path-storage

---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: local-path-provisioner-service-account
  namespace: local-path-storage

---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: local-path-provisioner-role
  namespace: local-path-storage
rules:
  - apiGroups: [""]
    resources: ["pods"]
    verbs: ["get", "list", "watch", "create", "patch", "update", "delete"]

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: local-path-provisioner-role
rules:
  - apiGroups: [""]
    resources: ["nodes", "persistentvolumeclaims", "configmaps", "pods", "pods/log"]
    verbs: ["get", "list", "watch"]
  - apiGroups: [""]
    resources: ["persistentvolumes"]
    verbs: ["get", "list", "watch", "create", "patch", "update", "delete"]
  - apiGroups: [""]
    resources: ["events"]
    verbs: ["create", "patch"]
  - apiGroups: ["storage.k8s.io"]
    resources: ["storageclasses"]
    verbs: ["get", "list", "watch"]

---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: local-path-provisioner-bind
  namespace: local-path-storage
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: local-path-provisioner-role
subjects:
  - kind: ServiceAccount
    name: local-path-provisioner-service-account
    namespace: local-path-storage

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: local-path-provisioner-bind
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: local-path-provisioner-role
subjects:
  - kind: ServiceAccount
    name: local-path-provisioner-service-account
    namespace: local-path-storage

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: local-path-provisioner
  namespace: local-path-storage
spec:
  replicas: 1
  selector:
    matchLabels:
      app: local-path-provisioner
  template:
    metadata:
      labels:
        app: local-path-provisioner
    spec:
      serviceAccountName: local-path-provisioner-service-account
      containers:
        - name: local-path-provisioner
          image: rancher/local-path-provisioner:v0.0.32
          imagePullPolicy: IfNotPresent
          command:
            - local-path-provisioner
            - --debug
            - start
            - --config
            - /etc/config/config.json
          volumeMounts:
            - name: config-volume
              mountPath: /etc/config/
          env:
            - name: POD_NAMESPACE
              valueFrom:
                fieldRef:
                  fieldPath: metadata.namespace
            - name: CONFIG_MOUNT_PATH
              value: /etc/config/
      volumes:
        - name: config-volume
          configMap:
            name: local-path-config

---
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: local-path
provisioner: rancher.io/local-path
volumeBindingMode: WaitForFirstConsumer
reclaimPolicy: Delete

---
kind: ConfigMap
apiVersion: v1
metadata:
  name: local-path-config
  namespace: local-path-storage
data:
  config.json: |-
    {
            "nodePathMap":[
            {
                    "node":"DEFAULT_PATH_FOR_NON_LISTED_NODES",
                    "paths":["/opt/local-path-provisioner"]
            }
            ]
    }
  setup: |-
    #!/bin/sh
    set -eu
    mkdir -m 0777 -p "$VOL_DIR"
  teardown: |-
    #!/bin/sh
    set -eu
    rm -rf "$VOL_DIR"
  helperPod.yaml: |-
    apiVersion: v1
    kind: Pod
    metadata:
      name: helper-pod
    spec:
      priorityClassName: system-node-critical
      tolerations:
        - key: node.kubernetes.io/disk-pressure
          operator: Exists
          effect: NoSchedule
      containers:
      - name: helper-pod
        image: busybox
        imagePullPolicy: IfNotPresent

######################################################################################################################################################
#### end of file local-path-storage.yaml ####
#### end of file local-path-storage.yaml ####

# infra/unistalKubeObjects.sh
#!/bin/bash
set -euo pipefail

###############################################################################
# Variables – must match the install script
###############################################################################
NAMESPACE="loader-infra"
POSTGRES_RELEASE="postgres"

SEALED_NS="sealed-secrets"
SEALED_RELEASE="sealed-secrets"

###############################################################################
# Helper
###############################################################################
run() {
  echo
  echo ">>> $*"
  eval "$@"
}

echo "This script will:"
echo "  - Uninstall Helm release '${POSTGRES_RELEASE}' in namespace '${NAMESPACE}' (if exists)"
echo "  - Delete namespace '${NAMESPACE}'"
echo "  - Uninstall Sealed Secrets controller '${SEALED_RELEASE}' in '${SEALED_NS}' (optional section)"
echo "  - Delete local YAML files: postgres-auth-plain.yaml, postgres-auth-sealed.yaml,"
echo "    values-postgresql.yaml, postgres-nodeport.yaml, local-path-storage.yaml (if present)"
echo

###############################################################################
# 1. Uninstall PostgreSQL Helm release (if exists)
###############################################################################
if helm status "${POSTGRES_RELEASE}" -n "${NAMESPACE}" >/dev/null 2>&1; then
  run "helm uninstall ${POSTGRES_RELEASE} -n ${NAMESPACE}"
else
  echo "Helm release '${POSTGRES_RELEASE}' not found in namespace '${NAMESPACE}', skipping."
fi

###############################################################################
# 2. Delete application namespace (loader-infra)
###############################################################################
run "kubectl delete namespace ${NAMESPACE} --ignore-not-found"

###############################################################################
# 3. OPTIONAL: Uninstall Sealed Secrets controller and namespace
#    Comment this block out if you want to keep Sealed Secrets for other uses.
###############################################################################
if helm status "${SEALED_RELEASE}" -n "${SEALED_NS}" >/dev/null 2>&1; then
  run "helm uninstall ${SEALED_RELEASE} -n ${SEALED_NS}"
else
  echo "Helm release '${SEALED_RELEASE}' not found in namespace '${SEALED_NS}', skipping."
fi

run "kubectl delete namespace ${SEALED_NS} --ignore-not-found"

# If you also want to remove the CRD, uncomment:
# run 'kubectl delete crd sealedsecrets.bitnami.com --ignore-not-found'

###############################################################################
# 4. OPTIONAL: Remove local-path provisioner (only if you are sure!)
#    If you used this cluster ONLY for your tests, you can remove it.
#    Otherwise, better leave it as-is.
###############################################################################
if [ -f "local-path-storage.yaml" ]; then
  echo
  echo "Removing local-path-storage objects from file local-path-storage.yaml"
  run "kubectl delete -f local-path-storage.yaml --ignore-not-found"
else
  echo "local-path-storage.yaml not found in current directory, skipping local-path cleanup."
fi

###############################################################################
# 5. Delete local YAML files created by the install script
###############################################################################
run "rm -f postgres-auth-plain.yaml postgres-auth-sealed.yaml values-postgresql.yaml postgres-nodeport.yaml"

echo
echo "======================================================================"
echo "Cleanup completed."
echo
echo "To rebuild everything:"
echo "  1) Run your install script again (the one that installs:"
echo "     - Sealed Secrets controller"
echo "     - postgres-auth sealed secret"
echo "     - Bitnami PostgreSQL"
echo "     - NodePort service on 30432"
echo "  2) Verify with:"
echo "       kubectl get pods -n ${NAMESPACE}"
echo "       kubectl get svc  -n ${NAMESPACE}"
echo "======================================================================"

######################################################################################################################################################
#### end of file unistalKubeObjects.sh ####
#### end of file unistalKubeObjects.sh ####

# infra/mysql/mysql-statefulset.yaml
apiVersion: v1
kind: Service
metadata:
  name: mysql
  namespace: monitoring-infra
  labels:
    app.kubernetes.io/name: mysql
    app.kubernetes.io/instance: infra
spec:
  ports:
    - port: 3306
      name: mysql
      protocol: TCP
      targetPort: 3306
  clusterIP: None          # Headless service for StatefulSet
  selector:
    app.kubernetes.io/name: mysql
    app.kubernetes.io/instance: infra
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mysql
  namespace: monitoring-infra
  labels:
    app.kubernetes.io/name: mysql
    app.kubernetes.io/instance: infra
spec:
  serviceName: mysql
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: mysql
      app.kubernetes.io/instance: infra
  template:
    metadata:
      labels:
        app: mysql
        app.kubernetes.io/name: mysql
        app.kubernetes.io/instance: infra
        app.kubernetes.io/component: primary
        app.kubernetes.io/part-of: monitoring-infra
    spec:
      containers:
        - name: mysql
          image: mysql:8.0
          imagePullPolicy: IfNotPresent
          ports:
            - containerPort: 3306
              name: mysql
              protocol: TCP
          env:
            - name: MYSQL_ROOT_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: infra-secrets
                  key: mysql-root-password

            - name: MYSQL_USER
              valueFrom:
                secretKeyRef:
                  name: infra-secrets
                  key: MYSQL_APP_USER

            - name: MYSQL_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: infra-secrets
                  key: mysql-password

            - name: MYSQL_DATABASE
              valueFrom:
                secretKeyRef:
                  name: infra-secrets
                  key: MYSQL_APP_DB

          volumeMounts:
            - name: mysql-data
              mountPath: /var/lib/mysql

          livenessProbe:
            exec:
              command: ["sh","-c",'mysqladmin ping -h 127.0.0.1 -uroot -p"$MYSQL_ROOT_PASSWORD"']
            initialDelaySeconds: 30
            periodSeconds: 10
            timeoutSeconds: 5

          readinessProbe:
            exec:
              command: ["sh","-c",'mysqladmin ping -h 127.0.0.1 -uroot -p"$MYSQL_ROOT_PASSWORD"']
            initialDelaySeconds: 10
            periodSeconds: 5
            timeoutSeconds: 3

  volumeClaimTemplates:
    - metadata:
        name: mysql-data
      spec:
        accessModes: ["ReadWriteOnce"]
        resources:
          requests:
            storage: 10Gi


######################################################################################################################################################
#### end of file mysql-statefulset.yaml ####
#### end of file mysql-statefulset.yaml ####

# infra/mysql/mysql-nodeport.yaml
apiVersion: v1
kind: Service
metadata:
  name: mysql-nodeport
  namespace: monitoring-infra
  labels:
    app.kubernetes.io/name: mysql
    app.kubernetes.io/instance: infra
    app.kubernetes.io/component: primary
    app.kubernetes.io/part-of: monitoring-infra
spec:
  type: NodePort
  selector:
    app.kubernetes.io/name: mysql
    app.kubernetes.io/instance: infra
    app.kubernetes.io/component: primary
    app.kubernetes.io/part-of: monitoring-infra
  ports:
    - name: mysql
      protocol: TCP
      port: 3306
      targetPort: 3306
      nodePort: 30306



######################################################################################################################################################
#### end of file mysql-nodeport.yaml ####
#### end of file mysql-nodeport.yaml ####

# infra/prometheus/values-kps.yaml
grafana:
  enabled: true
  service:
    type: ClusterIP
  persistence:
    enabled: true
    size: 5Gi

prometheus:
  service:
    type: ClusterIP
  prometheusSpec:
    retention: 7d
    storageSpec:
      volumeClaimTemplate:
        spec:
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 10Gi

alertmanager:
  enabled: true

######################################################################################################################################################
#### end of file values-kps.yaml ####
#### end of file values-kps.yaml ####

# infra/prometheus/AlertManager-nodeport.yaml
apiVersion: v1
kind: Service
metadata:
  name: alertmanager-nodeport
  namespace: monitoring-infra
  labels:
    app: alertmanager
spec:
  type: NodePort
  selector:
    app.kubernetes.io/name: alertmanager
    app.kubernetes.io/instance: monitoring-kube-prometheus-alertmanager
  ports:
    - name: http-web
      port: 9093
      targetPort: 9093
      nodePort: 30903


######################################################################################################################################################
#### end of file AlertManager-nodeport.yaml ####
#### end of file AlertManager-nodeport.yaml ####

# infra/prometheus/grafana-nodeport.yaml
apiVersion: v1
kind: Service
metadata:
  name: grafana-nodeport
  namespace: monitoring-infra
  labels:
    app: grafana
spec:
  type: NodePort
  selector:
    app.kubernetes.io/name: grafana
    app.kubernetes.io/instance: monitoring
  ports:
    - name: http
      port: 80
      targetPort: 3000
      nodePort: 30300

######################################################################################################################################################
#### end of file grafana-nodeport.yaml ####
#### end of file grafana-nodeport.yaml ####

# infra/prometheus/Prometheus-nodeport.yaml
apiVersion: v1
kind: Service
metadata:
  name: prometheus-nodeport
  namespace: monitoring-infra
  labels:
    app: prometheus
spec:
  type: NodePort
  selector:
    app.kubernetes.io/name: prometheus
    app.kubernetes.io/instance: monitoring-kube-prometheus-prometheus
  ports:
    - name: http-web
      port: 9090
      targetPort: 9090
      nodePort: 30900


######################################################################################################################################################
#### end of file Prometheus-nodeport.yaml ####
#### end of file Prometheus-nodeport.yaml ####

# infra_installer.sh
# ===================== Colors =====================
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
GREEN='\033[0;32m'
RED='\033[0;31m'
NC='\033[0m'   # No Color
SCRIPT_START_EPOCH="$(date +%s)"
SCRIPT_START_STR="$(date +"%Y-%m-%d %H:%M:%S")"

# ===================== Log Helpers =====================
log_info()  { printf "${BLUE}[INFO]${NC} %s\n" "$*"; }
log_debug() { printf "${YELLOW}[DEBUG]${NC} %s\n" "$*"; }
log_error() { printf "${RED}[ERROR]${NC} %s\n" "$*"; }
log_section() { printf "\n\033[0;35m--- %s ---\033[0m\n\n" "$*"; }  # purple section
log_purple()  { printf "\033[0;35m%s\033[0m\n" "$*"; }
exit_error() { log_error "$*"; exit 1; }

# ===================== Prompt Helper =====================
prompt_choice() {
  local message="$1"
  local options_str="$2"

  IFS='/' read -ra OPTIONS <<< "$options_str"
  local DEFAULT="${OPTIONS[0]}"

  while true; do
    printf "${GREEN}%s (%s): ${NC}" "$message" "$options_str"
    read -r CONFIRM < /dev/tty
    CONFIRM=${CONFIRM:-$DEFAULT}

    for opt in "${OPTIONS[@]}"; do
      if [[ "$CONFIRM" == "$opt" ]]; then
        return 0
      fi
    done

    log_error "Invalid option. Allowed values: ${options_str}"
  done
}


# ===================== Configuration =====================
log_section "Verify Configuration"
PROJECT_ROOT="/Volumes/Files/Projects/newLoader"
SEALED_NS="sealed-secrets"
I_NAMESPACE="monitoring-infra"
k_context="docker-desktop"

log_info "Switching to project root"
log_info "Please verify the parameters below before proceeding"

log_debug "PROJECT_ROOT = ${PROJECT_ROOT}"
log_debug "SEALED_NS    = ${SEALED_NS}"
log_debug "NAMESPACE    = ${I_NAMESPACE}"
log_debug "k_context    = ${k_context}"

prompt_choice "Is this valid configuration?" "Y/n"
[[ "$CONFIRM" =~ ^[Yy]$ ]] || exit_error "Aborted by user"

# ===================== kubectl Context =====================
log_section "Switch kubectl context"
if ! kubectl config use-context "${k_context}"; then
    exit_error "Failed to switch kubectl context to '${k_context}'"
fi

log_info "Current kubectl context: $(kubectl config current-context)"

prompt_choice "Is this valid context?" "Y/n"
[[ "$CONFIRM" =~ ^[Yy]$ ]] || exit_error "Aborted by user"

# ===================== Namespaces =====================
log_section "Creating namespaces"

kubectl create namespace "${SEALED_NS}" --dry-run=client -o yaml | kubectl apply -f -
kubectl create namespace "${I_NAMESPACE}" --dry-run=client -o yaml | kubectl apply -f -

log_info "Current Kubernetes namespaces:"
kubectl get namespaces

for ns in "${SEALED_NS}" "${I_NAMESPACE}"; do
    if ! kubectl get namespace "${ns}" >/dev/null 2>&1; then
        exit_error "Namespace '${ns}' was not created successfully"
    fi
done

log_info "Namespaces validated successfully"

# ===================== Sealed Secrets Controller =====================
log_section "installing Sealed Secrets Controller"
helm upgrade --install sealed-secrets sealed-secrets/sealed-secrets \
  --namespace ${SEALED_NS} \
  --set fullnameOverride=sealed-secrets

kubectl rollout status deployment/sealed-secrets -n ${SEALED_NS} --timeout=180s



# ===================== Sealed Secrets Values =====================
cd "${PROJECT_ROOT}/infra/secrets"
log_info "Current Path: $(pwd)"

log_section "installing Sealed Secrets "

kubeseal \
  --controller-name=sealed-secrets \
  --controller-namespace=${SEALED_NS} \
  --namespace ${I_NAMESPACE} \
  --format yaml \
  < monitoring-secrets-plain.yaml \
  > monitoring-secrets-sealed.yaml

kubectl apply -f monitoring-secrets-sealed.yaml


# ===================== storage class =====================

log_section "installing storage class"

curl -fsSL https://raw.githubusercontent.com/rancher/local-path-provisioner/master/deploy/local-path-storage.yaml -o local-path-storage.yaml
kubectl apply -f local-path-storage.yaml
kubectl get storageclass


# ===================== PostgresSQL =====================

log_section "installing PostgresSQL"

cd "${PROJECT_ROOT}/infra/postgress"
helm repo add bitnami https://charts.bitnami.com/bitnami
helm repo update

helm upgrade --install postgres bitnami/postgresql \
  -n ${I_NAMESPACE} \
  -f values-postgresql.yaml


kubectl rollout status statefulset/postgres-postgresql -n ${I_NAMESPACE} --timeout=300s
kubectl get pods -n ${I_NAMESPACE}


kubectl apply -f postgress/postgres-nodeport.yaml
kubectl get svc -n ${I_NAMESPACE}


# ===================== mysql =====================
cd "${PROJECT_ROOT}/infra/mysql"

log_section "installing mysql"


kubectl apply -f mysql-statefulset.yaml
kubectl rollout status statefulset/mysql -n "${I_NAMESPACE}" --timeout=300s
kubectl apply -f mysql-nodeport.yaml

kubectl rollout status statefulset/mysql -n ${I_NAMESPACE} --timeout=300s
kubectl get pods -n ${I_NAMESPACE}


# ===================== Redis =====================
cd "${PROJECT_ROOT}/infra/redis"

log_section "installing Redis"

helm repo add bitnami https://charts.bitnami.com/bitnami
helm repo update

helm upgrade --install redis bitnami/redis \
  -n monitoring-infra \
  -f values-redis.yaml


kubectl rollout status statefulset/redis-master -n monitoring-infra --timeout=300s


kubectl apply -f redis-nodeport.yaml


# ===================== prometheus =====================
cd "${PROJECT_ROOT}/infra/prometheus"

log_section "installing prometheus stack"

helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo update

helm upgrade --install monitoring prometheus-community/kube-prometheus-stack \
  -n monitoring-infra \
  -f values-kps.yaml
kubectl apply -f Prometheus-nodeport.yaml
kubectl apply -f AlertManager-nodeport.yaml
kubectl apply -f grafana-nodeport.yaml

# ===================== Execution Timing =====================

log_section "Installation execution summary"
SCRIPT_START_EPOCH="${SCRIPT_START_EPOCH:-$(date +%s)}"



format_ts() { date -r "$1" "+%Y-%m-%d %H:%M:%S %Z" 2>/dev/null || date -d "@$1" "+%Y-%m-%d %H:%M:%S %Z"; }

SCRIPT_END_EPOCH="$(date +%s)"
SCRIPT_END_STR="$(date +"%Y-%m-%d %H:%M:%S")"

DURATION_SEC=$((SCRIPT_END_EPOCH - SCRIPT_START_EPOCH))

# Human readable
DUR_H=$((DURATION_SEC / 3600))
DUR_M=$(((DURATION_SEC % 3600) / 60))
DUR_S=$((DURATION_SEC % 60))

end_str="$(format_ts "$SCRIPT_END_EPOCH")"


log_info "Script start: ${SCRIPT_START_STR}"
log_info "Script end  : ${SCRIPT_END_STR}"
log_info "Duration    : ${DUR_H}h ${DUR_M}m ${DUR_S}s (${DURATION_SEC}s)"

# ===================== 60s Countdown Before Smoke Test =====================
log_section "Preparing to run credential smoke tests"
log_info "Starting smoke tests in 60 seconds (press Ctrl+C to abort)..."

for i in $(seq 60 -1 1); do
  printf "\r\033[0;35mSmoke tests start in %2ds...\033[0m" "$i"
  sleep 1
done
printf "\r\033[0;35mSmoke tests starting now...      \033[0m\n"

# ===================== Work load check =====================
kubectl get nodes -o wide
kubectl get pods -A
kubectl get svc -n ${I_NAMESPACE}
kubectl get secret -n ${I_NAMESPACE}


# ===================== Credential Smoke Tests =====================
log_info "Running credential smoke tests for sealed secret: infra-secrets"

kubectl -n "$NS" delete pod redis-check pg-check mysql-check --ignore-not-found >/dev/null 2>&1 || true



SECRET_NAME="infra-secrets"
NS="${I_NAMESPACE}"

# Must exist and contain required keys
require_keys=(
  postgres-admin-password
  postgres-app-password
  mysql-root-password
  mysql-password
  MYSQL_APP_USER
  MYSQL_APP_DB
  redis-password
  REDIS_PORT
  GRAFANA_ADMIN_USER
  GRAFANA_ADMIN_PASSWORD
  ALERTMANAGER_BASIC_AUTH_USER
  ALERTMANAGER_BASIC_AUTH_PASSWORD
)

kubectl -n "$NS" get secret "$SECRET_NAME" >/dev/null 2>&1 || exit_error "Secret '$SECRET_NAME' not found in namespace '$NS'"

missing=0
for k in "${require_keys[@]}"; do
  if ! kubectl -n "$NS" get secret "$SECRET_NAME" -o jsonpath="{.data.$k}" 2>/dev/null | grep -q .; then
    log_error "Missing/empty key in $SECRET_NAME: $k"
    missing=1
  else
    log_info "Key present: $k"
  fi
done
[[ "$missing" -eq 0 ]] || exit_error "Secret keys validation failed"

# Decode helper (safe-ish: prints length only, not value)
secret_len() {
  local key="$1"
  local val
  val="$(kubectl -n "$NS" get secret "$SECRET_NAME" -o jsonpath="{.data.${key}}" | base64 -d 2>/dev/null || true)"
  printf "%s" "${#val}"
}

log_info "Secret value lengths (sanity):"
for k in "${require_keys[@]}"; do
  log_debug "$k length = $(secret_len "$k")"
done

# --- Verify pods are actually consuming the secret (envFrom/secretKeyRef/volume) ---
log_info "Checking workloads reference infra-secrets (envFrom/secretKeyRef/volume mounts)"

check_ref() {
  local kind="$1" name="$2"
  local y
  y="$(kubectl -n "$NS" get "$kind" "$name" -o yaml 2>/dev/null || true)"

  if [[ -z "$y" ]]; then
    log_error "$kind/$name not found"
    return 1
  fi

  if echo "$y" | grep -Eq "(secretName:\s*${SECRET_NAME}\b|name:\s*${SECRET_NAME}\b)"; then
    log_info "$kind/$name references ${SECRET_NAME}"
  else
    log_error "$kind/$name does NOT reference ${SECRET_NAME}"
    return 1
  fi
}


# Adjust names if yours differ
check_ref statefulset postgres-postgresql
check_ref statefulset mysql
check_ref statefulset redis-master

# kube-prometheus-stack components are usually deployments/statefulsets; we check all in namespace
log_info "Scanning all Deployments/StatefulSets for infra-secrets reference"
no_ref=0
for obj in $(kubectl -n "$NS" get deploy,sts -o name); do
  if kubectl -n "$NS" get "$obj" -o yaml | grep -q "name: ${SECRET_NAME}"; then
    log_debug "$obj -> uses infra-secrets"
  else
    # do not hard-fail here because many workloads do not need secrets
    :
  fi
done

# --- Runtime connectivity tests from inside cluster (preferred) ---
log_info "Running in-cluster connection checks (ephemeral pods)"
RID="smoke-$(date +%s)"

run_ephemeral_pod_and_get_logs() {
  local ns="$1"
  local pod="$2"
  local image="$3"
  local cmd="$4"

  kubectl -n "$ns" delete pod "$pod" --ignore-not-found >/dev/null 2>&1 || true

  kubectl -n "$ns" run "$pod" --restart=Never --image="$image" \
    --command -- sh -lc "$cmd" >/dev/null

  # Wait for phase=Succeeded (NOT Ready)
  if ! kubectl -n "$ns" wait pod "$pod" --for=jsonpath='{.status.phase}'=Succeeded --timeout=180s >/dev/null 2>&1; then
    local phase
    phase="$(kubectl -n "$ns" get pod "$pod" -o jsonpath='{.status.phase}' 2>/dev/null || echo UNKNOWN)"
    echo "[ERROR] Pod $pod did not succeed. phase=$phase" >&2
    kubectl -n "$ns" describe pod "$pod" >&2 || true
    kubectl -n "$ns" logs "$pod" >&2 || true
    kubectl -n "$ns" delete pod "$pod" --ignore-not-found >/dev/null 2>&1 || true
    return 1
  fi

  kubectl -n "$ns" logs "$pod" 2>/dev/null || true
  kubectl -n "$ns" delete pod "$pod" --ignore-not-found >/dev/null 2>&1 || true
}


# --- Redis ---
test_redis() {
  local ns="$1" secret="$2" rid="$3"
  local pod="redis-check-$rid"

  local redis_pwd
  redis_pwd="$(kubectl -n "$ns" get secret "$secret" -o jsonpath='{.data.redis-password}' | base64 -d)"

  local cmd="set -e; timeout 20s redis-cli -h redis-master -a \"$redis_pwd\" --no-auth-warning ping"
  local out
  out="$(run_ephemeral_pod_and_get_logs "$ns" "$pod" "redis:7-alpine" "$cmd")" || return 1

  echo "$out" | grep -q '^PONG' || { echo "[ERROR] Redis did not return PONG. Output: $out" >&2; return 1; }
  echo "[OK] Redis auth+ping"
}




# --- Postgres (admin) ---
test_pg_admin() {
  local ns="$1" secret="$2" rid="$3"
  local pod="pg-admin-check-$rid"

  # Adjust keys if yours differ
  local pg_host="postgres-postgresql"
  local admin_pwd
  admin_pwd="$(kubectl -n "$ns" get secret "$secret" -o jsonpath='{.data.postgres-admin-password}' | base64 -d)"

  # Bitnami often uses user "postgres" for admin; if yours is different, change it here:
  local admin_user="postgres"
  local admin_db="postgres"

  local cmd="set -e;
    export PGPASSWORD=\"$admin_pwd\";
    timeout 30s psql -h \"$pg_host\" -U \"$admin_user\" -d \"$admin_db\" -c 'SELECT 1 AS ok;'"
  local out
  out="$(run_ephemeral_pod_and_get_logs "$ns" "$pod" "postgres:16-alpine" "$cmd")" || return 1

  echo "$out" | grep -q 'ok' || { echo "[ERROR] Postgres admin test failed. Output: $out" >&2; return 1; }
  echo "[OK] Postgres admin login"
}

test_pg_app() {
  local ns="$1" secret="$2" rid="$3"
  local pod="pg-app-check-$rid"

  local pg_host="postgres-postgresql"

  # Adjust these keys if your secret uses different ones
  local app_user="alerts_user"
  local app_db="alerts_db"
  local app_pwd
  app_pwd="$(kubectl -n "$ns" get secret "$secret" -o jsonpath='{.data.postgres-app-password}' | base64 -d)"

  local cmd="set -e;
    export PGPASSWORD=\"$app_pwd\";
    timeout 30s psql -h \"$pg_host\" -U \"$app_user\" -d \"$app_db\" -c 'SELECT current_database() AS db, current_user AS user;'"
  local out
  out="$(run_ephemeral_pod_and_get_logs "$ns" "$pod" "postgres:16-alpine" "$cmd")" || return 1

  echo "$out" | grep -q "$app_db" || { echo "[ERROR] Postgres app test failed. Output: $out" >&2; return 1; }
  echo "[OK] Postgres app login (db=$app_db user=$app_user)"
}


# --- MySQL (root) ---
test_mysql_root() {
  local ns="$1" secret="$2" rid="$3"
  local pod="mysql-root-check-$rid"

  local root_pwd
  root_pwd="$(kubectl -n "$ns" get secret "$secret" -o jsonpath='{.data.mysql-root-password}' | base64 -d)"

  local cmd="set -e;
    timeout 30s mysql -h mysql -uroot -p\"$root_pwd\" -e 'SELECT 1 AS ok;'"
  local out
  out="$(run_ephemeral_pod_and_get_logs "$ns" "$pod" "mysql:8.0" "$cmd")" || return 1

  echo "$out" | grep -q 'ok' || { echo "[ERROR] MySQL root test failed. Output: $out" >&2; return 1; }
  echo "[OK] MySQL root login"
}

test_mysql_app() {
  local ns="$1" secret="$2" rid="$3"
  local pod="mysql-app-check-$rid"

  local app_user app_db app_pwd
  app_user="$(kubectl -n "$ns" get secret "$secret" -o jsonpath='{.data.MYSQL_APP_USER}' | base64 -d)"
  app_db="$(kubectl -n "$ns" get secret "$secret" -o jsonpath='{.data.MYSQL_APP_DB}' | base64 -d)"
  app_pwd="$(kubectl -n "$ns" get secret "$secret" -o jsonpath='{.data.mysql-password}' | base64 -d)"

  local cmd="set -e;
    timeout 30s mysql -h mysql -u\"$app_user\" -p\"$app_pwd\" -D\"$app_db\" -e 'SELECT DATABASE() AS db, CURRENT_USER() AS user;'"
  local out
  out="$(run_ephemeral_pod_and_get_logs "$ns" "$pod" "mysql:8.0" "$cmd")" || return 1

  echo "$out" | grep -q "$app_db" || { echo "[ERROR] MySQL app test failed. Output: $out" >&2; return 1; }
  echo "[OK] MySQL app login (db=$app_db user=$app_user)"
}

NS="monitoring-infra"
SECRET_NAME="infra-secrets"
RID="$(date +%s)"

test_redis "$NS" "$SECRET_NAME" "$RID"
test_mysql_root "$NS" "$SECRET_NAME" "$RID"
test_mysql_app "$NS" "$SECRET_NAME" "$RID"
test_pg_admin "$NS" "$SECRET_NAME" "$RID"
test_pg_app "$NS" "$SECRET_NAME" "$RID"

log_info "Credential smoke tests completed successfully"


######################################################################################################################################################
#### end of file infra_installer.sh ####
#### end of file infra_installer.sh ####

# .DS_Store
[SKIPPED: non-text or binary file]
######################################################################################################################################################
#### end of file .DS_Store ####
#### end of file .DS_Store ####

# printProject.sh
#!/usr/bin/env bash
set -euo pipefail

###############################################################################
# Dump directory tree and all file contents into a single output file
###############################################################################

# Resolve script directory
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
ROOT_DIR="$SCRIPT_DIR"

DATE_STR="$(date +%Y%m%d)"
OUT_FILE="${SCRIPT_DIR}/output_${DATE_STR}.txt"

# Create / overwrite output file
: > "$OUT_FILE"

# Separator line: "###" repeated 50 times (single line)
SEP_LINE="$(printf '###%.0s' {1..50})"

###############################################################################
# Directory tree
###############################################################################
{
  echo "########## DIRECTORY TREE: ${ROOT_DIR} ##########"
  if command -v tree >/dev/null 2>&1; then
    tree -a "$ROOT_DIR"
  else
    echo "(tree command not found — using find)"
    find "$ROOT_DIR"
  fi
  echo
  echo "########## FILE CONTENTS ##########"
  echo
} >> "$OUT_FILE"

###############################################################################
# Dump files
###############################################################################
while IFS= read -r -d '' f; do
  fname="$(basename "$f")"

  # Exclude any file starting with "output"
  [[ "$fname" == output* ]] && continue

  rel_path="${f#"$ROOT_DIR"/}"

  # Skip binary files if 'file' command exists
  if command -v file >/dev/null 2>&1; then
    if ! file -b --mime "$f" | grep -qiE 'charset=(us-ascii|utf-8|utf-16|iso-8859|windows-1252)'; then
      {
        echo "# ${rel_path}"
        echo "[SKIPPED: non-text or binary file]"
        echo "$SEP_LINE"
        echo "#### end of file ${fname} ####"
        echo "#### end of file ${fname} ####"
        echo
      } >> "$OUT_FILE"
      continue
    fi
  fi

  {
    echo "# ${rel_path}"
    cat "$f"
    echo
    echo "$SEP_LINE"
    echo "#### end of file ${fname} ####"
    echo "#### end of file ${fname} ####"
    echo
  } >> "$OUT_FILE"

done < <(
  find "$ROOT_DIR" \
    -type d \( -name .git -o -name node_modules -o -name .venv -o -name dist -o -name build \) -prune -false \
    -o -type f -print0
)

echo "Done."
echo "Root directory : $ROOT_DIR"
echo "Output file    : $OUT_FILE"

######################################################################################################################################################
#### end of file printProject.sh ####
#### end of file printProject.sh ####

# README.md
# Monitronig Project – Local Kubernetes & Database Infrastructure (Dev Setup)

This document provides **raw shell commands only** to install and operate a local Kubernetes-based database infrastructure for development.

It covers:
- Single-node Kubernetes cluster for development
- Stable API endpoint via `127.0.0.1` (no Wi‑Fi IP dependency)
- `kubectl`, `kubeadm`, `helm`, `kubeseal`
- Sealed Secrets controller
- PostgreSQL via Bitnami Helm chart
- MySQL via Bitnami Helm chart

> **Important:**
> - This repository intentionally contains **no `.sh` files**.
> - All steps below are provided as **direct shell commands**.
> - Plain secrets must **never** be committed.

---

## 0. Project Files

All commands assume this root path on your machine is already synchronized with git repo:

```bash
./
├── kube
│   ├── install.sh #(ignored)
│   └── unistall.sh#(ignored)
├── monitoring
│   ├── infra
│   │   ├── 00_setup_sealed_secret.sh #(ignored)
│   │   ├── 01_install_postgress.sh #(ignored)
│   │   ├── 02_install_mysql.sh  #(ignored)
│   │   ├── mysql
│   │   │   └── values-mysql.yaml 
│   │   ├── postgress
│   │   │   ├── postgres-nodeport.yaml
│   │   │   └── values-postgresql.yaml
│   │   ├── secrets
│   │   │   ├── monitoring-secrets-plain.yaml #(ignored)
│   │   │   └── monitoring-secrets-sealed.yaml
│   │   └── unistalKubeObjects.sh #(ignored)
│   └── services (in progress)
```


---

## 1. Linux – Kubernetes Cluster with Static API (`127.0.0.1`)

> Skip this section if you already have a working cluster (e.g., on macOS via Docker Desktop).

### 1.1 Reset Existing Cluster (if needed)

```bash
sudo kubeadm reset -f
sudo systemctl stop kubelet
sudo systemctl stop containerd || true
sudo rm -rf /etc/cni/net.d
sudo ip link delete cni0 2>/dev/null || true
sudo ip link delete flannel.1 2>/dev/null || true
sudo rm -rf /var/lib/etcd
sudo rm -rf /etc/kubernetes
```

---

### 1.2 Install and Configure containerd

```bash
sudo apt update
sudo apt install -y containerd
sudo mkdir -p /etc/containerd
containerd config default | sudo tee /etc/containerd/config.toml >/dev/null
sudo sed -i 's/SystemdCgroup = false/SystemdCgroup = true/' /etc/containerd/config.toml
sudo systemctl restart containerd
sudo systemctl enable containerd
```

---

### 1.3 Kernel Modules & Sysctl

```bash
cat <<EOF | sudo tee /etc/modules-load.d/k8s.conf
overlay
br_netfilter
EOF

sudo modprobe overlay
sudo modprobe br_netfilter

cat <<EOF | sudo tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-iptables  = 1
net.bridge.bridge-nf-call-ip6tables = 1
net.ipv4.ip_forward                 = 1
EOF

sudo sysctl --system
```

---

### 1.4 Disable Swap

```bash
sudo swapoff -a
sudo sed -i '/ swap / s/^\(.*\)$/#\1/g' /etc/fstab
```

---

### 1.5 Install kubeadm, kubelet, kubectl

```bash
sudo mkdir -p /etc/apt/keyrings

curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.30/deb/Release.key | \
  sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg

echo "deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.30/deb/ /" | \
  sudo tee /etc/apt/sources.list.d/kubernetes.list

sudo apt update
sudo apt install -y kubelet kubeadm kubectl
sudo apt-mark hold kubelet kubeadm kubectl
```

---

### 1.6 Initialize Cluster with Stable API

```bash
sudo kubeadm init \
  --control-plane-endpoint=127.0.0.1:6443 \
  --apiserver-advertise-address=0.0.0.0 \
  --pod-network-cidr=192.168.0.0/16 \
  --cri-socket=unix:///var/run/containerd/containerd.sock
```

After success:

```bash
mkdir -p $HOME/.kube
sudo cp /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown "$(id -u):$(id -g)" $HOME/.kube/config
```

Verify:

```bash
kubectl get nodes
grep server: ~/.kube/config
```

---

## 2. macOS – Tools Only

On macOS you typically use Docker Desktop or another local Kubernetes distribution.

```bash
brew install kubectl helm
```

Verify:

```bash
kubectl get nodes
```

---

## 3. Install Helm and kubeseal (Linux & macOS)

### Helm

Linux:

```bash
curl -fsSL https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
```

macOS:

```bash
brew install helm
```

---

### kubeseal

```bash
KUBESEAL_VERSION="0.19.1"
curl -sSL https://github.com/bitnami-labs/sealed-secrets/releases/download/v${KUBESEAL_VERSION}/kubeseal-${KUBESEAL_VERSION}-$(uname | tr '[:upper:]' '[:lower:]')-amd64.tar.gz -o kubeseal.tar.gz

tar -xzf kubeseal.tar.gz
sudo install -m 0755 kubeseal /usr/local/bin/kubeseal
rm -f kubeseal kubeseal.tar.gz
kubeseal --version
```

---

## 4. Enable Workloads on Single Node

```bash
kubectl taint nodes --all node-role.kubernetes.io/control-plane- || true
```

---
## 5. Set ProjectRoot

```bash
PROJECT_ROOT="/Volumes/Files/Projects/newLoader"
echo "**** Switching to Project Root"
echo "⚠️  please verify project root in path  your environment"
echo ${PROJECT_ROOT}
cd ${PROJECT_ROOT}

````

## 6. Install Sealed Secrets Controller

```bash
cd ${PROJECT_ROOT}
SEALED_NS="sealed-secrets"
helm repo add sealed-secrets https://bitnami-labs.github.io/sealed-secrets
helm repo update

kubectl create namespace ${SEALED_NS} --dry-run=client -o yaml | kubectl apply -f -

helm upgrade --install sealed-secrets sealed-secrets/sealed-secrets \
  --namespace ${SEALED_NS} \
  --set fullnameOverride=sealed-secrets

kubectl rollout status deployment/sealed-secrets -n ${SEALED_NS} --timeout=180s
```

---

## 7. Create Application Namespace

```bash
cd ${PROJECT_ROOT}
NAMESPACE="monitoring-infra"
kubectl create namespace ${NAMESPACE} --dry-run=client -o yaml | kubectl apply -f -
```

---

## 8. Create Plain Secret Locally and Seal It

```bash

cd ${PROJECT_ROOT}/infra
mkdir -p secrets
```

```bash
cat > secrets/monitoring-secrets-plain.yaml <<EOF
apiVersion: v1
kind: Secret
metadata:
  name: monitoring-secrets
  namespace: ${NAMESPACE}
type: Opaque
stringData:
  #postgres infra keys
  postgres-admin-password: "someVal"
  postgres-app-password:   "someVal"

  #mysql infra keys
  mysql-root-password:     "someVal"
  mysql-password:          "CHANGE_ME"
  mysql-replication-password: "someVal"
  MYSQL_APP_USER: "someVal"
  MYSQL_APP_DB:   "someVal"
EOF
```

```bash
kubeseal \
  --controller-name=sealed-secrets \
  --controller-namespace=${SEALED_NS} \
  --namespace ${NAMESPACE} \
  --format yaml \
  < secrets/monitoring-secrets-plain.yaml \
  > secrets/monitoring-secrets-sealed.yaml

kubectl apply -f secrets/monitoring-secrets-sealed.yaml
```

---

## 9. StorageClass (Linux Bare-Metal)

```bash
curl -fsSL https://raw.githubusercontent.com/rancher/local-path-provisioner/master/deploy/local-path-storage.yaml -o local-path-storage.yaml
kubectl apply -f local-path-storage.yaml
kubectl get storageclass
```

---

## 10. Install PostgreSQL via Helm

```bash
cd ./monitoring/infra
helm repo add bitnami https://charts.bitnami.com/bitnami
helm repo update

helm upgrade --install postgres bitnami/postgresql \
  -n ${NAMESPACE} \
  -f postgress/values-postgresql.yaml
```

```bash
kubectl rollout status statefulset/postgres-postgresql -n ${NAMESPACE} --timeout=300s
kubectl get pods -n ${NAMESPACE}
```

```bash
kubectl apply -f postgress/postgres-nodeport.yaml
kubectl get svc -n ${NAMESPACE}
```

```bash
psql -h 127.0.0.1 -p 30432 -U alerts_user -d alerts_db
```

---

## 11. Install MySQL via statful set

```bash
cd ./monitoring/infra

k apply -f ./mysql/mysql-statefulset.yaml

#helm upgrade --install mysql bitnami/mysql \
#  -n ${NAMESPACE} \
#  -f mysql/values-mysql.yaml
```

```bash
kubectl rollout status statefulset/mysql -n ${NAMESPACE} --timeout=300s
kubectl get pods -n ${NAMESPACE}
```

```bash
k apply -f ./${PROJECT_ROOT}/infra/mysql/mysql-nodeport.yaml

mysql -h 127.0.0.1 -P 30306 -u test_user -p


```
---
## 12. install redis via helm

```bash
helm repo add bitnami https://charts.bitnami.com/bitnami
helm repo update

helm upgrade --install redis bitnami/redis \
  -n monitoring-infra \
  -f redis/values-redis.yaml

```
#### Wait:
```bash
kubectl rollout status statefulset/redis-master -n monitoring-infra --timeout=300s
```

#### expose service
```bash
kubectl apply -f ./${PROJECT_ROOT}/infra/redis/redis-nodeport.yaml
```

#### Test Access

```bash
redis-cli -a "$(kubectl get secret infra-secrets -n monitoring-infra -o jsonpath='{.data.redis-password}' | base64 -d)"


```

## 13. Install prometheus via helm
### - add and update helm repo

```bash
# Add repo
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo update

```

### - install helm

```bash
helm upgrade --install monitoring prometheus-community/kube-prometheus-stack \
  -n monitoring-infra \
  -f values-kps.yaml

```

### - verify pods status helm
```bash
kubectl get pods -n monitoring-infra
kubectl get svc -n monitoring-infra | egrep 'grafana|prometheus|alertmanager'
```
## 11. Health Check

```bash
kubectl get nodes -o wide
kubectl get pods -A
kubectl get svc -n ${NAMESPACE}
kubectl get secret -n ${NAMESPACE}
```

---

## ✅ Result

- Encrypted secrets only
- PostgreSQL + MySQL deployed via Helm
- Stable Kubernetes API on `127.0.0.1`
- No plaintext secrets in Git
- No shell scripts tracked in the repository

######################################################################################################################################################
#### end of file README.md ####
#### end of file README.md ####

# .gitignore
# Ignore all shell scripts
*.sh

# Ignore all plain secrets YAMLs
*-plain.yaml

# (Optional but recommended)
.DS_Store
.env

######################################################################################################################################################
#### end of file .gitignore ####
#### end of file .gitignore ####

# kube/unistall.sh
#!/bin/bash
set -euo pipefail

echo ">>> Stopping kubelet (if running) ..."
sudo systemctl stop kubelet 2>/dev/null || true

echo ">>> Resetting kubeadm cluster state ..."
sudo kubeadm reset -f || true

echo ">>> Cleaning CNI configuration ..."
sudo rm -rf /etc/cni/net.d
sudo ip link delete cni0 2>/dev/null || true
sudo ip link delete flannel.1 2>/dev/null || true

echo ">>> Cleaning Kubernetes data directories ..."
sudo rm -rf /etc/kubernetes
sudo rm -rf /var/lib/etcd
sudo rm -rf /var/lib/kubelet/pki

echo ">>> Flushing iptables rules (nat, mangle, filter) ..."
sudo iptables -F || true
sudo iptables -t nat -F || true
sudo iptables -t mangle -F || true
sudo iptables -X || true

echo ">>> Removing old kubeconfig for current user ..."
rm -rf "$HOME/.kube" || true

echo
echo "======================================================================"
echo "Cluster reset complete."
echo "You can now run 01_install_k8s_single_node.sh to create a fresh cluster."
echo "======================================================================"

######################################################################################################################################################
#### end of file unistall.sh ####
#### end of file unistall.sh ####

# kube/install.sh
#!/bin/bash
set -euo pipefail

###############################################################################
# Config
###############################################################################
APISERVER_ADDRESS="127.0.0.1"     # Avoid WiFi IP; always loopback
POD_CIDR="10.244.0.0/16"          # Flannel default
K8S_VERSION="1.30"                # Minor version; apt will pick a 1.30.x
FLANNEL_MANIFEST="https://raw.githubusercontent.com/flannel-io/flannel/master/Documentation/kube-flannel.yml"

###############################################################################
# Helper
###############################################################################
run() {
  echo
  echo ">>> $*"
  eval "$@"
}

###############################################################################
# 0. Basic sanity
###############################################################################
if ! command -v curl >/dev/null 2>&1; then
  echo "curl is required. Installing curl ..."
  sudo apt update
  sudo apt install -y curl
fi

echo ">>> Disabling swap (required by Kubernetes) ..."
sudo swapoff -a
sudo sed -i.bak '/ swap / s/^\(.*\)$/#\1/' /etc/fstab || true

###############################################################################
# 1. Kernel modules & sysctl for Kubernetes networking
###############################################################################
echo ">>> Loading kernel modules: overlay, br_netfilter ..."
cat <<EOF | sudo tee /etc/modules-load.d/k8s.conf
overlay
br_netfilter
EOF

sudo modprobe overlay
sudo modprobe br_netfilter

echo ">>> Setting sysctl params for Kubernetes networking ..."
cat <<EOF | sudo tee /etc/sysctl.d/99-k8s.conf
net.bridge.bridge-nf-call-iptables  = 1
net.bridge.bridge-nf-call-ip6tables = 1
net.ipv4.ip_forward                 = 1
EOF

sudo sysctl --system

###############################################################################
# 2. Install & configure containerd
###############################################################################
if ! command -v containerd >/dev/null 2>&1; then
  echo ">>> Installing containerd ..."
  sudo apt update
  sudo apt install -y containerd
fi

echo ">>> Configuring containerd (SystemdCgroup = true) ..."
sudo mkdir -p /etc/containerd
if [ ! -f /etc/containerd/config.toml ]; then
  sudo containerd config default | sudo tee /etc/containerd/config.toml >/dev/null
fi

# Set SystemdCgroup = true
sudo sed -i 's/SystemdCgroup = false/SystemdCgroup = true/' /etc/containerd/config.toml

echo ">>> Restarting containerd ..."
sudo systemctl daemon-reload
sudo systemctl enable containerd
sudo systemctl restart containerd

###############################################################################
# 3. Install Kubernetes packages (kubeadm, kubelet, kubectl)
###############################################################################
if ! command -v kubeadm >/dev/null 2>&1; then
  echo ">>> Installing Kubernetes packages kubeadm, kubelet, kubectl ..."

  sudo apt update
  sudo apt install -y apt-transport-https ca-certificates gpg

  sudo mkdir -p /etc/apt/keyrings
  curl -fsSL https://pkgs.k8s.io/core:/stable:/v${K8S_VERSION}/deb/Release.key | \
    sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg

  echo "deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] \
https://pkgs.k8s.io/core:/stable:/v${K8S_VERSION}/deb/ /" | \
    sudo tee /etc/apt/sources.list.d/kubernetes.list

  sudo apt update
  sudo apt install -y kubelet kubeadm kubectl
  sudo apt-mark hold kubelet kubeadm kubectl
else
  echo "kubeadm/kubelet/kubectl already installed."
fi

###############################################################################
# 4. kubeadm init with fixed API server IP (127.0.0.1) and flannel CIDR
###############################################################################
echo ">>> Running kubeadm init with apiserver ${APISERVER_ADDRESS} and pod CIDR ${POD_CIDR} ..."

sudo kubeadm init \
  --pod-network-cidr="${POD_CIDR}" \
  --apiserver-advertise-address="${APISERVER_ADDRESS}" \
  --control-plane-endpoint="${APISERVER_ADDRESS}:6443" \
  --cri-socket=unix:///var/run/containerd/containerd.sock

###############################################################################
# 5. Setup kubeconfig for current user
###############################################################################
echo ">>> Configuring kubeconfig for user: $USER ..."
mkdir -p "$HOME/.kube"
sudo cp /etc/kubernetes/admin.conf "$HOME/.kube/config"
sudo chown "$(id -u):$(id -g)" "$HOME/.kube/config"

echo ">>> Verifying kubeconfig server points to 127.0.0.1 ..."
grep server: "$HOME/.kube/config" || true

###############################################################################
# 6. Install Flannel CNI
###############################################################################
echo ">>> Installing flannel CNI ..."
run "kubectl apply -f ${FLANNEL_MANIFEST}"

echo ">>> Waiting for flannel DaemonSet to be ready ..."
run "kubectl -n kube-flannel rollout status daemonset/kube-flannel-ds --timeout=300s"

###############################################################################
# 7. Allow scheduling on control-plane node
###############################################################################
echo ">>> Removing control-plane taint so workloads can run on this node ..."
run "kubectl taint nodes --all node-role.kubernetes.io/control-plane- || true"
run "kubectl taint nodes --all node-role.kubernetes.io/master- || true"

###############################################################################
# 8. Summary
###############################################################################
echo
echo "======================================================================"
echo "Kubernetes single-node dev cluster is ready."
echo
echo "API server URL      : https://${APISERVER_ADDRESS}:6443"
echo "Pod network (CIDR)  : ${POD_CIDR}"
echo "Container runtime   : containerd"
echo "CNI                 : flannel"
echo
echo "kubeconfig          : $HOME/.kube/config"
echo "Check node status   : kubectl get nodes -o wide"
echo "Check system pods   : kubectl get pods -A"
echo
echo "Because we use 127.0.0.1, changing WiFi / IP will NOT break kubectl."
echo "======================================================================"

######################################################################################################################################################
#### end of file install.sh ####
#### end of file install.sh ####

# services/.DS_Store
[SKIPPED: non-text or binary file]
######################################################################################################################################################
#### end of file .DS_Store ####
#### end of file .DS_Store ####

# services/secrets/app-secrets-plain.yaml
apiVersion: v1
kind: Secret
metadata:
  name: app-secrets
  namespace: monitoring-app
type: Opaque
stringData:
  #Env
  ENV_PROFILE: "DEV"

  # MYSQL Credentials
  MYSQL_APP_USER: "test_user"
  MYSQL_APP_DB: "test_data"
  MYSQL_HOST: "mysql.monitoring-infra.svc.cluster.local"
  MYSQL_PORT: "3306"
  MYSQL_APP_PASSWORD: "HaAirK101348qAppD"

######################################################################################################################################################
#### end of file app-secrets-plain.yaml ####
#### end of file app-secrets-plain.yaml ####

# services/secrets/app-secrets-sealed.yaml
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  creationTimestamp: null
  name: app-secrets
  namespace: monitoring-app
spec:
  encryptedData:
    ENV_PROFILE: AgBxYa4Axlx3inv2TbYuOunYLsJ22t7kqEfLRLehuODnU+HgB13vKJIKPpnx7u2XDL0dtAbMD/gkWHIfzyfuh8NBxgPcj7M5s8KSEMfdoIUf6r4Z+QtgGCFqNtkg96St5WZ+qWgP+UvktMPMYyNTSkeTLckD2onp3nQ9Cb0VbIB1fkRAK4Dh0MepzpbMB2oRJH+cfGyB8b3J+GSHmX65dwwsd1AyUW99Je+sB7hWIqpkluJJe9jYhJFUPObtbOo9YIEW11ZDPrUrTfvyjFOm18GkZWo7v253dUwqD0Lg1ZLgGP5FTPMMcyXFaxYfFwfLCbd3T++m4Di5tSwS/H+tbKZqxGvjJo6DJ22U0haeICTsZo1DxmkYNTX2+bEKOW4k86bffRezuGQNWazlXj5gHPsM4zKFZwwys77BJciXDqJiVShpxiDTiqApQLL2pWnXyfTvSRYf1UfbYWwSobC+heTfFezklcYX5bYRMM7ZGIAstXv9RpgMaJ3v95yfjn1F3f724U14s+X608dqm5rBUARy+AET6l4g+CW0P8gijW5jsKgGkQ2RZ3TtBCDl1zccvLiYSs+sGjJpV7BmGl7UtSdNuUKjuMJYrO6EghO8V11ydPYWd/MSS3qv9L9K//Gg0olOoB7JiaTSCIXDZktFrvNcXgAf22QHumFSja6e8bwBTP74qMYZ/Ytl9Ifz33wHZ/Duz6w=
    MYSQL_APP_DB: AgAk1AslPhZkxzkttgIFPr9oll1bOM3UfXjvbSQf+9LflGJ/xbt3+MrBEPMDmtzkdiF7owdN5U+oHc9E/VV6COxjqogxnBzfEwkGHDgq0mUknf1FJcXmiHHLz3N19d/qUJzKCF70BW3kjF0ZyYW6q/Gkx4MnGPIi+WnP2BotxYS0erFJgNA0Dip0CsvyvDihgFxRjs11kg8Q6n9wMWcuCKwidOROVR9XGUWf8mM26rPWSdqrW0iWsBsH/V69qQloYZZqAYGvKs9RXDVp+3mfhrqPxVRr6eP0KcdQzWFkA/tpYNb4cJeLYxqze+aS8yaskSLliLKXhLPEVnyDOaNFberBzyD3D5mGU+zNxMT57Ptg2hWtpijleHiAvBQX2yTlxMcl9DE5rxt4r3Ga76WZk29d/YakeGCkkkEgMlcNndVyD5IBDNCiBsaH6K1GtNVsXE/X1eX8WOL03ChoUx3XucDVoasMjWEfOavKmQpqc8NWkQ5YTHgYKh0hLLSWAOZ6B3Cpe/fzp3uFgbYK8EGZbD0uv0h/Zm4nQ3Sp0DUGwRckJ+lIx4teUaUSJd3NPJS43ts+aLh5eFHYMpAG8EEuESybWXdLOKHH97nsO3UjCxj69K2SeJwS0I9QsyiZz+lY/hShaoJZE7FWXY+XAES98nzBNDHHEidOcwbCuy+SOfFdPIKalgVV9M6Yazei71EnOJFdqDZNgaf3ouE=
    MYSQL_APP_PASSWORD: AgCW9BmN3zSUikwJFxjvBizwso2ZQqAe/4bTMRndb/gh1fCPw+j38ByWHPPPkWNzIfgm2VO5halPHewM/8zpfoPMe8EeF4IDOM0IZhTH+hFoRwBRYCBjNTUOv2OYxF/UEdhPkwS1GWjMcdILVmwnvE02D0UFila9XRVfFXC/CPp7PCK4UeDRPQEQEm4RJorbcADyihenlPABzVmVTDSP+D4TeFn/hEnp3FHXVMdf+GNvOzAWGbpwKuc0oH2b00E1dwMYQopMGGCxSAzhoewGbRsFgUIIfRCmsU2GFJBiu3rnzWRZcAM1ov2Xg667MjeeupglCT9NtM148VDY9X/7SQomlu+kbI3YxafdZaGlRJTcJjhJCt23/+hXyIrguS2uBmiWZiXDhK8vwyQlHR003skgh8OPeh/FtlQWca3oJHm017exdmbWiPb2P69Jy3YQzvjIr9RSh8Ao4+vVNO0evtoA3Py39zq6UvydYL1bJUkw/Q6A7O25/k8OFkBzgYQ8c3aE7jwy+BgMnDYfnTdKbb+mXy48JdT6nrzboqWIVbiUDjca8s6T2BtyCO81ZjI9mb/XDW/tC9T/oBJNGHKhqG946m3x1eIOOwCT2sfVCd39govf1hHdGvJ1asdj1PS07vWhPviO6YRjNx3TQW85rxHIHna2kTb6nThDT6u0iJkomrep/ZxihQT6D+82tzUUjzVCtZtj868tdmYTK1w2kqaNkA==
    MYSQL_APP_USER: AgCzA62O9SoJO+92N7iHKOSdNsBhr5VnScqUoWMSVUxfM5npa+ySP6U38zZtmyPfEH/WMMqUZMEa9lKdp3QFj8zCdTw6+SFmvo2wh/V1/ATqDfqWlifBucVWjVShwjgpk/bo60sIZVYZEWWvYjJ1sUkGQKQCJ7n+yYPgiHhsWk7xB9xqZWk4/S7FmH7+q3M2IpSTcdPy8mwAb1yTfYMPS3KIcJ9BGiaZx64MRd0/zLh4doK5MhStrBQR6HzYJ+ZxbLpzP65TETYBp64EnM7Mp1XiVfBJeK8RVy934ndpC86mn+B/5VTZ6pOMPyHdTdmeQXtHKyGvPrKQJj85VlIW+BsEjVmWkkkW3sqE0UzDwEVYf0KqsKVHJjg5Z5ffMkKWWe5oIouEFtTXYgzqVDqT/Dp417oamq0FADZPDwPj/gpr1BjuLtyZN+xL3b12ePKU3SuVGwtDT1nWfXlQ9Igchwlz3iVB2WddJ0lik20PODaBHwH/HyyAOkeU40RMoH+841n1PcSlsVw9IEZVbIfn3mg3soCkAThsiDcWuTzj3VAAaR9qYaBuPzz5b0EIZ9rcAIwjlvYbtwLeNWYFQJep+m0lzuktSBSAFVdcoFIwTBgExEgGqLewiv5nb3V5wQ6rRo3q1MtaU/s871eLI3BPa9nnTvpFD8UwtM3SIN8A38u9tvC3bZ3DbvKGjvWO/ft4/BfbohKW3sC9klE=
    MYSQL_HOST: AgCwyIQfcNTkvLZJTJVzSZuikPyrcS9sO8PgLCFpbk0pl9Zy8gwY253zDW1i20+3FcOxRBtupT/0X1jIggtScrxkZIFaRS2BnBmU8Uuhcp6iKJo+DrJvLRi5aFy1UCNUTAJOEQgtkzrGauGB5cI+LpsjogSFKyS6dnt8qRf6V3EYTq/aka8bCCXNwPBGGNyJKjOHixbzrmb16JOQBDlb6GswVdwnlWHWT1vCxdT8VuN4/n3KIBlBfIvohir6WKVVzM3PSrgBOkH0q3WlRpTUc1FIuH77STjpQbZpX3NJYg07V/W0xOqBrzIxnynIKh41ukPJQEHKRr0Ztm52NmmcrsxaJ3wvGi9uzP1b5fphE0VuZ8DbiM/nIdn6HO16fMeG2TbfAygsAwi0n3/3zA1rxNGUC+NFhpipxx/zOyrfWrD8NpOSl7QG/aUG1MpKxb4wHRY9HWbgAK0dfkVTsMXXsaJI9eA2QsCd1EtJkChPa1PFwPHhJ7GDi3mLdr/Pkhk2NKE3dKZ12RpiLURk/JKozNl0hiJsVH6RBqBHgayh8FtEUXJaThzfOLyc7HGf+u7Wmxyvb7NOCfC+HpPTcUP73CIjOF52jr1vN1I8KS86RNvMGpTjvUvazSOWJwUG7JC+ewOeQFGlw7kt94l+WvHJG4CsMmIVeQNpiwEbOu5KmoCt40YKQqmxj66RbYvfj4c9RB6Hv49gNgxJMGTSYlE2/0z5j49QoowdTiN/OYoFRjthedPEDvIJr4uY
    MYSQL_PORT: AgBMXKz4HTsK7ijeHkabkYcMJj5bM261DenjtwUtRQCsc7YXnGIJE38U13OQ2J3lpxHmjluKtNjZyRRUdY5zvIVBBmdpf1fHmcM4OsYdC9QkCN93hBl3aETpPjaR4b3/lbyE5NZhTDXJvWMw9gUVKSP0kUxpsCK1Wsj4V0XzoVL2EiKcqqES8LEYd95HNFuOAXSQtbTcax15eSjf2H083cWBliagE5eUq+rC3ZJ0v0Y+ON6gLv+CwjR17DII0LXzOoqyY5XqSxKG5N1cK3u5Da189BmmbYhhBHzzYlh84YXQSCHEARl0CmpovJI/CiIlngjn1e0pNprVa39chTw2HOMB2W4v8Qh2avYo8aYCDxpFyjUuXZdSzRir+S2amKReQzzphBhS2bcLr0l742EfPuiWSwsP+Zd6rlZ3hJEfjI3gkGqaeQeYzgi4sStAWhK7LWcW1z9yMVgx7kXuGqnOqEEUIAR+UUNaXctc8EF/13ZLY1+6C296G+tRSLMyXjqvd0gu9xDucNBqggwGd6VXMQvQPGqw5p+aFjVycPhF4U9OiUZj2xEnepwpH3BlLi92uF3aQTZm51ZkwoX1hvFr8I8ez/1K/0BqKAlKy7ZR4Rzyja+YcCGIGapAmBsYTdUqhBQXwz2Y83MvcRdvXDdTjn9x6yYKPuh7S0nR/l/ZQ3EqdhsLDkD5ejP617wuW4tP3kwNGlfh
  template:
    metadata:
      creationTimestamp: null
      name: app-secrets
      namespace: monitoring-app
    type: Opaque
---

######################################################################################################################################################
#### end of file app-secrets-sealed.yaml ####
#### end of file app-secrets-sealed.yaml ####

# services/dataGenerator/.DS_Store
[SKIPPED: non-text or binary file]
######################################################################################################################################################
#### end of file .DS_Store ####
#### end of file .DS_Store ####

# services/dataGenerator/Dockerfile
# Stage 1: Build
FROM maven:3.9-eclipse-temurin-17 AS build
WORKDIR /app

# Copy POM and download dependencies
COPY pom.xml .
RUN mvn dependency:go-offline -B

# Copy source code and build
COPY src ./src
RUN mvn clean package -DskipTests

# Stage 2: Runtime
FROM eclipse-temurin:17-jre
WORKDIR /app

# Create non-root user
RUN groupadd -r spring && useradd -r -g spring spring
USER spring:spring

# Copy JAR from build stage
COPY --from=build /app/target/*.jar app.jar

# Expose actuator port
EXPOSE 8080

# Run with dev profile
ENTRYPOINT ["java", "-Dspring.profiles.active=dev", "-jar", "app.jar"]

######################################################################################################################################################
#### end of file Dockerfile ####
#### end of file Dockerfile ####

# services/dataGenerator/target/data-generator-0.0.1-SNAPSHOT.jar
[SKIPPED: non-text or binary file]
######################################################################################################################################################
#### end of file data-generator-0.0.1-SNAPSHOT.jar ####
#### end of file data-generator-0.0.1-SNAPSHOT.jar ####

# services/dataGenerator/target/classes/META-INF/spring-configuration-metadata.json
{
  "groups": [
    {
      "name": "data-generator",
      "type": "com.loader.datagenerator.model.DataGeneratorConfig",
      "sourceType": "com.loader.datagenerator.model.DataGeneratorConfig"
    },
    {
      "name": "data-generator.mysql",
      "type": "com.loader.datagenerator.model.DataGeneratorConfig$MysqlConfig",
      "sourceType": "com.loader.datagenerator.model.DataGeneratorConfig"
    }
  ],
  "properties": [
    {
      "name": "data-generator.downtime",
      "type": "java.util.List<com.loader.datagenerator.model.DowntimeConfig>",
      "sourceType": "com.loader.datagenerator.model.DataGeneratorConfig"
    },
    {
      "name": "data-generator.mysql.database",
      "type": "java.lang.String",
      "sourceType": "com.loader.datagenerator.model.DataGeneratorConfig$MysqlConfig"
    },
    {
      "name": "data-generator.mysql.host",
      "type": "java.lang.String",
      "sourceType": "com.loader.datagenerator.model.DataGeneratorConfig$MysqlConfig"
    },
    {
      "name": "data-generator.mysql.password",
      "type": "java.lang.String",
      "sourceType": "com.loader.datagenerator.model.DataGeneratorConfig$MysqlConfig"
    },
    {
      "name": "data-generator.mysql.port",
      "type": "java.lang.Integer",
      "sourceType": "com.loader.datagenerator.model.DataGeneratorConfig$MysqlConfig"
    },
    {
      "name": "data-generator.mysql.user",
      "type": "java.lang.String",
      "sourceType": "com.loader.datagenerator.model.DataGeneratorConfig$MysqlConfig"
    },
    {
      "name": "data-generator.tables",
      "type": "java.util.List<com.loader.datagenerator.model.TableConfig>",
      "sourceType": "com.loader.datagenerator.model.DataGeneratorConfig"
    }
  ],
  "hints": [],
  "ignored": {
    "properties": []
  }
}
######################################################################################################################################################
#### end of file spring-configuration-metadata.json ####
#### end of file spring-configuration-metadata.json ####

# services/dataGenerator/target/classes/com/loader/datagenerator/runner/ScheduledDataGenerator.class
[SKIPPED: non-text or binary file]
######################################################################################################################################################
#### end of file ScheduledDataGenerator.class ####
#### end of file ScheduledDataGenerator.class ####

# services/dataGenerator/target/classes/com/loader/datagenerator/runner/SchemaInitializer.class
[SKIPPED: non-text or binary file]
######################################################################################################################################################
#### end of file SchemaInitializer.class ####
#### end of file SchemaInitializer.class ####

# services/dataGenerator/target/classes/com/loader/datagenerator/runner/SchemaInitializer$1.class
[SKIPPED: non-text or binary file]
######################################################################################################################################################
#### end of file SchemaInitializer$1.class ####
#### end of file SchemaInitializer$1.class ####

# services/dataGenerator/target/classes/com/loader/datagenerator/model/TableConfig.class
[SKIPPED: non-text or binary file]
######################################################################################################################################################
#### end of file TableConfig.class ####
#### end of file TableConfig.class ####

# services/dataGenerator/target/classes/com/loader/datagenerator/model/ColumnConfig.class
[SKIPPED: non-text or binary file]
######################################################################################################################################################
#### end of file ColumnConfig.class ####
#### end of file ColumnConfig.class ####

# services/dataGenerator/target/classes/com/loader/datagenerator/model/DowntimeConfig.class
[SKIPPED: non-text or binary file]
######################################################################################################################################################
#### end of file DowntimeConfig.class ####
#### end of file DowntimeConfig.class ####

# services/dataGenerator/target/classes/com/loader/datagenerator/model/DataGeneratorConfig.class
[SKIPPED: non-text or binary file]
######################################################################################################################################################
#### end of file DataGeneratorConfig.class ####
#### end of file DataGeneratorConfig.class ####

# services/dataGenerator/target/classes/com/loader/datagenerator/model/ColumnConfig$ColumnType.class
[SKIPPED: non-text or binary file]
######################################################################################################################################################
#### end of file ColumnConfig$ColumnType.class ####
#### end of file ColumnConfig$ColumnType.class ####

# services/dataGenerator/target/classes/com/loader/datagenerator/model/DataGeneratorConfig$MysqlConfig.class
[SKIPPED: non-text or binary file]
######################################################################################################################################################
#### end of file DataGeneratorConfig$MysqlConfig.class ####
#### end of file DataGeneratorConfig$MysqlConfig.class ####

# services/dataGenerator/target/classes/com/loader/datagenerator/model/TableConfig$RecordRateConfig.class
[SKIPPED: non-text or binary file]
######################################################################################################################################################
#### end of file TableConfig$RecordRateConfig.class ####
#### end of file TableConfig$RecordRateConfig.class ####

# services/dataGenerator/target/classes/com/loader/datagenerator/service/DataGeneratorService.class
[SKIPPED: non-text or binary file]
######################################################################################################################################################
#### end of file DataGeneratorService.class ####
#### end of file DataGeneratorService.class ####

# services/dataGenerator/target/classes/com/loader/datagenerator/service/DataGeneratorService$1.class
[SKIPPED: non-text or binary file]
######################################################################################################################################################
#### end of file DataGeneratorService$1.class ####
#### end of file DataGeneratorService$1.class ####

# services/dataGenerator/target/classes/com/loader/datagenerator/DataGeneratorApplication.class
[SKIPPED: non-text or binary file]
######################################################################################################################################################
#### end of file DataGeneratorApplication.class ####
#### end of file DataGeneratorApplication.class ####

# services/dataGenerator/target/classes/data-generator-config.yaml
# Test Data Generator Configuration
# DEV-ONLY: Defines tables, columns, data types, and generation rules

data-generator:
  mysql:
    host: ${MYSQL_HOST:mysql.loader-infra.svc.cluster.local}
    port: ${MYSQL_PORT:3306}
    database: ${MYSQL_DATABASE:testdata}
    user: ${MYSQL_USER:testuser}
    password: ${MYSQL_PASSWORD:testuser_password_dev}

  # Table definitions
  tables:
    # Example 1: Sales transactions
    - name: sales_data
      recordsPerMinute:
        min: 10
        max: 50
      columns:
        - name: transaction_id
          type: integer
          range: [1000, 999999]

        - name: amount
          type: float
          range: [10.0, 5000.0]
          precision: 2

        - name: product
          type: list
          values: ["Laptop", "Phone", "Tablet", "Monitor", "Keyboard", "Mouse", "Headphones", "Speaker"]

        - name: description
          type: random_text
          minLength: 10
          maxLength: 100

        - name: timestamp
          type: timestamp

    # Example 2: User activity
    - name: user_activity
      recordsPerMinute:
        min: 20
        max: 100
      columns:
        - name: user_id
          type: integer
          range: [1, 10000]

        - name: action
          type: list
          values: ["login", "logout", "view", "purchase", "add_to_cart", "search"]

        - name: session_duration
          type: integer
          range: [1, 3600]

        - name: timestamp
          type: timestamp

    # Example 3: Sensor readings
    - name: sensor_readings
      recordsPerMinute:
        min: 5
        max: 20
      columns:
        - name: sensor_id
          type: integer
          range: [1, 100]

        - name: temperature
          type: float
          range: [-20.0, 50.0]
          precision: 1

        - name: humidity
          type: float
          range: [0.0, 100.0]
          precision: 1

        - name: pressure
          type: float
          range: [900.0, 1100.0]
          precision: 2

        - name: location
          type: list
          values: ["Building-A", "Building-B", "Building-C", "Warehouse", "Lab"]

        - name: timestamp
          type: timestamp

  # Downtime simulation periods (optional)
  downtime:
    - start: "02:00"
      end: "02:15"
      reason: "Simulated nightly maintenance"

    - start: "14:30"
      end: "14:45"
      reason: "Simulated network issue"

######################################################################################################################################################
#### end of file data-generator-config.yaml ####
#### end of file data-generator-config.yaml ####

# services/dataGenerator/target/classes/application.yaml
spring:
  config:
     import: optional:classpath:data-generator-config.yaml
  application:
    name: data-generator

  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}

  # MySQL DataSource Configuration
  datasource:
    url: jdbc:mysql://${MYSQL_HOST:localhost}:${MYSQL_PORT:3306}/${MYSQL_DATABASE:testdata}?createDatabaseIfNotExist=true
    username: ${MYSQL_USER:testuser}
    password: ${MYSQL_PASSWORD:testuser_password_dev}
    driver-class-name: com.mysql.cj.jdbc.Driver

    # HikariCP settings
    hikari:
      maximum-pool-size: 10
      minimum-idle: 2
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

# Logging Configuration
logging:
  level:
    root: INFO
    com.loader.datagenerator: DEBUG
    org.springframework.jdbc: DEBUG
    org.springframework.jdbc.core.JdbcTemplate: TRACE
    org.springframework.scheduling: DEBUG
    com.zaxxer.hikari: DEBUG
    com.zaxxer.hikari.HikariConfig: DEBUG

# Data Generator Configuration (loaded from external config)
data-generator:
  mysql:
    host: ${MYSQL_HOST:localhost}
    port: ${MYSQL_PORT:3306}
    database: ${MYSQL_DATABASE:testdata}
    user: ${MYSQL_USER:testuser}
    password: ${MYSQL_PASSWORD:testuser_password_dev}

  # Tables configuration - will be overridden by config file
  tables: []

  # Downtime configuration - will be overridden by config file
  downtime: []

# Management endpoints
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: always

######################################################################################################################################################
#### end of file application.yaml ####
#### end of file application.yaml ####

# services/dataGenerator/target/maven-status/maven-compiler-plugin/compile/default-compile/inputFiles.lst
/Volumes/Files/Projects/newLoader/services/dataGenerator/src/main/java/com/loader/datagenerator/DataGeneratorApplication.java
/Volumes/Files/Projects/newLoader/services/dataGenerator/src/main/java/com/loader/datagenerator/model/ColumnConfig.java
/Volumes/Files/Projects/newLoader/services/dataGenerator/src/main/java/com/loader/datagenerator/model/DataGeneratorConfig.java
/Volumes/Files/Projects/newLoader/services/dataGenerator/src/main/java/com/loader/datagenerator/model/DowntimeConfig.java
/Volumes/Files/Projects/newLoader/services/dataGenerator/src/main/java/com/loader/datagenerator/model/TableConfig.java
/Volumes/Files/Projects/newLoader/services/dataGenerator/src/main/java/com/loader/datagenerator/runner/ScheduledDataGenerator.java
/Volumes/Files/Projects/newLoader/services/dataGenerator/src/main/java/com/loader/datagenerator/runner/SchemaInitializer.java
/Volumes/Files/Projects/newLoader/services/dataGenerator/src/main/java/com/loader/datagenerator/service/DataGeneratorService.java

######################################################################################################################################################
#### end of file inputFiles.lst ####
#### end of file inputFiles.lst ####

# services/dataGenerator/target/maven-status/maven-compiler-plugin/compile/default-compile/createdFiles.lst
com/loader/datagenerator/runner/SchemaInitializer.class
META-INF/spring-configuration-metadata.json
com/loader/datagenerator/model/ColumnConfig.class
com/loader/datagenerator/DataGeneratorApplication.class
com/loader/datagenerator/runner/ScheduledDataGenerator.class
com/loader/datagenerator/model/TableConfig$RecordRateConfig.class
com/loader/datagenerator/service/DataGeneratorService.class
com/loader/datagenerator/model/TableConfig.class
com/loader/datagenerator/model/DowntimeConfig.class
com/loader/datagenerator/model/DataGeneratorConfig.class
com/loader/datagenerator/service/DataGeneratorService$1.class
com/loader/datagenerator/model/ColumnConfig$ColumnType.class
com/loader/datagenerator/runner/SchemaInitializer$1.class
com/loader/datagenerator/model/DataGeneratorConfig$MysqlConfig.class

######################################################################################################################################################
#### end of file createdFiles.lst ####
#### end of file createdFiles.lst ####

# services/dataGenerator/target/maven-archiver/pom.properties
artifactId=data-generator
groupId=com.loader
version=0.0.1-SNAPSHOT

######################################################################################################################################################
#### end of file pom.properties ####
#### end of file pom.properties ####

# services/dataGenerator/target/data-generator-0.0.1-SNAPSHOT.jar.original
[SKIPPED: non-text or binary file]
######################################################################################################################################################
#### end of file data-generator-0.0.1-SNAPSHOT.jar.original ####
#### end of file data-generator-0.0.1-SNAPSHOT.jar.original ####

# services/dataGenerator/pom.xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
         http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>3.5.6</version>
        <relativePath/>
    </parent>

    <groupId>com.loader</groupId>
    <artifactId>data-generator</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <name>Test Data Generator</name>
    <description>DEV-ONLY: Generates random test data for MySQL database</description>

    <properties>
        <java.version>17</java.version>
    </properties>

    <dependencies>
        <!-- Spring Boot Web Starter (includes embedded Tomcat for actuator endpoints) -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        <!-- Spring Boot JDBC -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-jdbc</artifactId>
        </dependency>

        <!-- Spring Boot Actuator -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-actuator</artifactId>
        </dependency>

        <!-- MySQL Connector -->
        <dependency>
            <groupId>com.mysql</groupId>
            <artifactId>mysql-connector-j</artifactId>
            <scope>runtime</scope>
        </dependency>

        <!-- Configuration Processor -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-configuration-processor</artifactId>
            <optional>true</optional>
        </dependency>

        <!-- Lombok -->
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <optional>true</optional>
        </dependency>

        <!-- Test Dependencies -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <configuration>
                    <excludes>
                        <exclude>
                            <groupId>org.projectlombok</groupId>
                            <artifactId>lombok</artifactId>
                        </exclude>
                    </excludes>
                    <image>
                        <name>data-generator:${project.version}</name>
                    </image>
                </configuration>
            </plugin>
        </plugins>
    </build>
</project>

######################################################################################################################################################
#### end of file pom.xml ####
#### end of file pom.xml ####

# services/dataGenerator/k8s_manifist/.DS_Store
[SKIPPED: non-text or binary file]
######################################################################################################################################################
#### end of file .DS_Store ####
#### end of file .DS_Store ####

# services/dataGenerator/k8s_manifist/data-generator-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: data-generator
  namespace: monitoring-app
  labels:
    app: data-generator
    component: test-utility
    environment: dev
spec:
  replicas: 1
  selector:
    matchLabels:
      app: data-generator
  template:
    metadata:
      labels:
        app: data-generator
        component: test-utility
        environment: dev
    spec:
      containers:
      - name: data-generator
        image: data-generator:0.0.1-SNAPSHOT
        imagePullPolicy: IfNotPresent

        ports:
          - name: http
            containerPort: 8080
            protocol: TCP

        env:
        # Spring Profile
        - name: SPRING_PROFILES_ACTIVE
          value: "dev"

        # MySQL Connection (from secret)
        - name: MYSQL_HOST
          valueFrom:
            secretKeyRef:
              name: app-secrets
              key: MYSQL_HOST
        - name: MYSQL_PORT
          valueFrom:
            secretKeyRef:
              name: app-secrets
              key: MYSQL_PORT
        - name: MYSQL_DATABASE
          valueFrom:
            secretKeyRef:
              name: app-secrets
              key: MYSQL_APP_DB
        - name: MYSQL_USER
          valueFrom:
            secretKeyRef:
              name: app-secrets
              key: MYSQL_APP_USER
        - name: MYSQL_PASSWORD
          valueFrom:
            secretKeyRef:
              name: app-secrets
              key: MYSQL_APP_PASSWORD

        resources:
          requests:
            memory: "256Mi"
            cpu: "100m"
          limits:
            memory: "512Mi"
            cpu: "500m"

        livenessProbe:
          httpGet:
            path: /actuator/health
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 30
          timeoutSeconds: 5
          failureThreshold: 3

        readinessProbe:
          httpGet:
            path: /actuator/health
            port: 8080
          initialDelaySeconds: 20
          periodSeconds: 10
          timeoutSeconds: 5
          failureThreshold: 3

        
---
apiVersion: v1
kind: Service
metadata:
  name: data-generator
  namespace: monitoring-app
  labels:
    app: data-generator
spec:
  type: ClusterIP
  selector:
    app: data-generator
  ports:
    - name: http
      port: 8080
      targetPort: 8080
      protocol: TCP

######################################################################################################################################################
#### end of file data-generator-deployment.yaml ####
#### end of file data-generator-deployment.yaml ####

# services/dataGenerator/local-path-storage.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: local-path-storage

---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: local-path-provisioner-service-account
  namespace: local-path-storage

---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: local-path-provisioner-role
  namespace: local-path-storage
rules:
  - apiGroups: [""]
    resources: ["pods"]
    verbs: ["get", "list", "watch", "create", "patch", "update", "delete"]

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: local-path-provisioner-role
rules:
  - apiGroups: [""]
    resources: ["nodes", "persistentvolumeclaims", "configmaps", "pods", "pods/log"]
    verbs: ["get", "list", "watch"]
  - apiGroups: [""]
    resources: ["persistentvolumes"]
    verbs: ["get", "list", "watch", "create", "patch", "update", "delete"]
  - apiGroups: [""]
    resources: ["events"]
    verbs: ["create", "patch"]
  - apiGroups: ["storage.k8s.io"]
    resources: ["storageclasses"]
    verbs: ["get", "list", "watch"]

---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: local-path-provisioner-bind
  namespace: local-path-storage
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: local-path-provisioner-role
subjects:
  - kind: ServiceAccount
    name: local-path-provisioner-service-account
    namespace: local-path-storage

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: local-path-provisioner-bind
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: local-path-provisioner-role
subjects:
  - kind: ServiceAccount
    name: local-path-provisioner-service-account
    namespace: local-path-storage

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: local-path-provisioner
  namespace: local-path-storage
spec:
  replicas: 1
  selector:
    matchLabels:
      app: local-path-provisioner
  template:
    metadata:
      labels:
        app: local-path-provisioner
    spec:
      serviceAccountName: local-path-provisioner-service-account
      containers:
        - name: local-path-provisioner
          image: rancher/local-path-provisioner:v0.0.32
          imagePullPolicy: IfNotPresent
          command:
            - local-path-provisioner
            - --debug
            - start
            - --config
            - /etc/config/config.json
          volumeMounts:
            - name: config-volume
              mountPath: /etc/config/
          env:
            - name: POD_NAMESPACE
              valueFrom:
                fieldRef:
                  fieldPath: metadata.namespace
            - name: CONFIG_MOUNT_PATH
              value: /etc/config/
      volumes:
        - name: config-volume
          configMap:
            name: local-path-config

---
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: local-path
provisioner: rancher.io/local-path
volumeBindingMode: WaitForFirstConsumer
reclaimPolicy: Delete

---
kind: ConfigMap
apiVersion: v1
metadata:
  name: local-path-config
  namespace: local-path-storage
data:
  config.json: |-
    {
            "nodePathMap":[
            {
                    "node":"DEFAULT_PATH_FOR_NON_LISTED_NODES",
                    "paths":["/opt/local-path-provisioner"]
            }
            ]
    }
  setup: |-
    #!/bin/sh
    set -eu
    mkdir -m 0777 -p "$VOL_DIR"
  teardown: |-
    #!/bin/sh
    set -eu
    rm -rf "$VOL_DIR"
  helperPod.yaml: |-
    apiVersion: v1
    kind: Pod
    metadata:
      name: helper-pod
    spec:
      priorityClassName: system-node-critical
      tolerations:
        - key: node.kubernetes.io/disk-pressure
          operator: Exists
          effect: NoSchedule
      containers:
      - name: helper-pod
        image: busybox
        imagePullPolicy: IfNotPresent

######################################################################################################################################################
#### end of file local-path-storage.yaml ####
#### end of file local-path-storage.yaml ####

# services/dataGenerator/.idea/stat.log
{"ts":1765967168459,"action":"PROJECT_OPENED","tags":{"PROJECT_NAME":"dataGenerator"}}
{"ts":1765967168588,"action":"FILE_OPENED","file":"/README.md","tags":{"FILE_LINE_OF_CODE":"384"}}
{"ts":1765967261717,"action":"IDE_DEACTIVATED"}
{"ts":1765967681679,"action":"IDE_ACTIVATED"}
{"ts":1765967690119,"action":"PROJECT_CLOSED","tags":{"PROJECT_NAME":"dataGenerator"}}
{"ts":1765972723964,"action":"FILE_OPENED","file":"/README.md","tags":{"FILE_LINE_OF_CODE":"384"}}
{"ts":1765972723961,"action":"PROJECT_OPENED","tags":{"PROJECT_NAME":"dataGenerator"}}
{"ts":1765972743353,"action":"FILE_OPENED","file":"/local-path-storage.yaml","tags":{"FILE_LINE_OF_CODE":"162"}}
{"ts":1765972803895,"action":"IDE_DEACTIVATED"}
{"ts":1765973006855,"action":"IDE_ACTIVATED"}
{"ts":1765973012742,"action":"FILE_CLOSED","file":"/local-path-storage.yaml","tags":{"FILE_LINE_OF_CODE":"162"}}
{"ts":1765973012756,"action":"FILE_OPENED","file":"/src/main/java/com/loader/datagenerator/runner/SchemaInitializer.java","tags":{"FILE_LINE_OF_CODE":"116"}}
{"ts":1765973135563,"action":"IDE_DEACTIVATED"}
{"ts":1765973143475,"action":"IDE_ACTIVATED"}
{"ts":1765973500527,"action":"FILE_CLOSED","file":"/src/main/java/com/loader/datagenerator/runner/SchemaInitializer.java","tags":{"FILE_LINE_OF_CODE":"116"}}
{"ts":1765973500532,"action":"FILE_OPENED","file":"/src/main/resources/application.yaml","tags":{"FILE_LINE_OF_CODE":"58"}}
{"ts":1765973531526,"action":"IDE_DEACTIVATED"}
{"ts":1765973758377,"action":"IDE_ACTIVATED"}
{"ts":1765973769395,"action":"FILE_CLOSED","file":"/src/main/resources/application.yaml","tags":{"FILE_LINE_OF_CODE":"60"}}
{"ts":1765973790987,"action":"IDE_DEACTIVATED"}
{"ts":1765973807647,"action":"IDE_ACTIVATED"}
{"ts":1765973861238,"action":"IDE_DEACTIVATED"}
{"ts":1765973905366,"action":"IDE_ACTIVATED"}
{"ts":1765974215089,"action":"IDE_DEACTIVATED"}
{"ts":1765974241921,"action":"IDE_ACTIVATED"}
{"ts":1765974257730,"action":"IDE_DEACTIVATED"}
{"ts":1765974277983,"action":"IDE_ACTIVATED"}
{"ts":1765974281435,"action":"IDE_DEACTIVATED"}
{"ts":1765974292344,"action":"IDE_ACTIVATED"}
{"ts":1765974302191,"action":"IDE_DEACTIVATED"}
{"ts":1765974304485,"action":"IDE_ACTIVATED"}
{"ts":1765974308494,"action":"IDE_DEACTIVATED"}
{"ts":1765974325700,"action":"IDE_ACTIVATED"}
{"ts":1765974339625,"action":"IDE_DEACTIVATED"}
{"ts":1765974345580,"action":"IDE_ACTIVATED"}
{"ts":1765974349465,"action":"IDE_DEACTIVATED"}
{"ts":1765974402826,"action":"IDE_ACTIVATED"}
{"ts":1765974488563,"action":"IDE_DEACTIVATED"}
{"ts":1765974494289,"action":"IDE_ACTIVATED"}
{"ts":1765974497799,"action":"IDE_DEACTIVATED"}
{"ts":1765974499723,"action":"IDE_ACTIVATED"}
{"ts":1765974500246,"action":"IDE_DEACTIVATED"}
{"ts":1765974547581,"action":"IDE_ACTIVATED"}
{"ts":1765974549886,"action":"IDE_DEACTIVATED"}
{"ts":1765974607230,"action":"IDE_ACTIVATED"}
{"ts":1765974625861,"action":"IDE_DEACTIVATED"}
{"ts":1765974635568,"action":"IDE_ACTIVATED"}
{"ts":1765974642652,"action":"IDE_DEACTIVATED"}
{"ts":1765975291191,"action":"PROJECT_CLOSED","tags":{"PROJECT_NAME":"dataGenerator"}}

######################################################################################################################################################
#### end of file stat.log ####
#### end of file stat.log ####

# services/dataGenerator/.idea/encodings.xml
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="Encoding">
    <file url="file://$PROJECT_DIR$/src/main/java" charset="UTF-8" />
  </component>
</project>
######################################################################################################################################################
#### end of file encodings.xml ####
#### end of file encodings.xml ####

# services/dataGenerator/.idea/jarRepositories.xml
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="RemoteRepositoriesConfiguration">
    <remote-repository>
      <option name="id" value="central" />
      <option name="name" value="Central Repository" />
      <option name="url" value="https://repo.maven.apache.org/maven2" />
    </remote-repository>
    <remote-repository>
      <option name="id" value="central" />
      <option name="name" value="Maven Central repository" />
      <option name="url" value="https://repo1.maven.org/maven2" />
    </remote-repository>
    <remote-repository>
      <option name="id" value="jboss.community" />
      <option name="name" value="JBoss Community repository" />
      <option name="url" value="https://repository.jboss.org/nexus/content/repositories/public/" />
    </remote-repository>
  </component>
</project>
######################################################################################################################################################
#### end of file jarRepositories.xml ####
#### end of file jarRepositories.xml ####

# services/dataGenerator/.idea/vcs.xml
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="VcsDirectoryMappings">
    <mapping directory="$PROJECT_DIR$/../.." vcs="Git" />
  </component>
</project>
######################################################################################################################################################
#### end of file vcs.xml ####
#### end of file vcs.xml ####

# services/dataGenerator/.idea/.gitignore
# Default ignored files
/shelf/
/workspace.xml
# Editor-based HTTP Client requests
/httpRequests/
# Datasource local storage ignored files
/dataSources/
/dataSources.local.xml

######################################################################################################################################################
#### end of file .gitignore ####
#### end of file .gitignore ####

# services/dataGenerator/.idea/workspace.xml
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="AutoImportSettings">
    <option name="autoReloadType" value="SELECTIVE" />
  </component>
  <component name="ChangeListManager">
    <list default="true" id="0495c818-8a9d-4e15-bead-eef57ea7cb2a" name="Changes" comment="">
      <change beforePath="$PROJECT_DIR$/../../README.md" beforeDir="false" afterPath="$PROJECT_DIR$/../../README.md" afterDir="false" />
      <change beforePath="$PROJECT_DIR$/../../infra/mysql/values-mysql.yaml" beforeDir="false" />
      <change beforePath="$PROJECT_DIR$/../../infra/secrets/monitoring-secrets-sealed.yaml" beforeDir="false" afterPath="$PROJECT_DIR$/../../infra/secrets/monitoring-secrets-sealed.yaml" afterDir="false" />
    </list>
    <option name="SHOW_DIALOG" value="false" />
    <option name="HIGHLIGHT_CONFLICTS" value="true" />
    <option name="HIGHLIGHT_NON_ACTIVE_CHANGELIST" value="false" />
    <option name="LAST_RESOLUTION" value="IGNORE" />
  </component>
  <component name="Git.Settings">
    <option name="RECENT_GIT_ROOT_PATH" value="$PROJECT_DIR$/../.." />
  </component>
  <component name="GitHubPullRequestSearchHistory">{
  &quot;lastFilter&quot;: {
    &quot;state&quot;: &quot;OPEN&quot;,
    &quot;assignee&quot;: &quot;hrawashdeh&quot;
  }
}</component>
  <component name="GithubPullRequestsUISettings">{
  &quot;selectedUrlAndAccountId&quot;: {
    &quot;url&quot;: &quot;https://github.com/hrawashdeh/newMonitoring.git&quot;,
    &quot;accountId&quot;: &quot;cf0b02f8-3d61-4d1f-aa0d-c6209cc2ae6b&quot;
  }
}</component>
  <component name="KubernetesApiPersistence"><![CDATA[{}]]></component>
  <component name="KubernetesApiProvider"><![CDATA[{
  "configuredContexts": [
    {
      "name": "docker-desktop",
      "kubeConfigUrl": "file:///Users/hassanrawashdeh/.kube/config",
      "currentNamespace": "monitoring-app"
    }
  ],
  "isMigrated": true
}]]></component>
  <component name="ProjectColorInfo">{
  &quot;associatedIndex&quot;: 8
}</component>
  <component name="ProjectId" id="36y7t2KFUI4buPoa7HyvYiXrgve" />
  <component name="ProjectViewState">
    <option name="hideEmptyMiddlePackages" value="true" />
    <option name="showLibraryContents" value="true" />
  </component>
  <component name="PropertiesComponent">{
  &quot;keyToString&quot;: {
    &quot;RunOnceActivity.ShowReadmeOnStart&quot;: &quot;true&quot;,
    &quot;git-widget-placeholder&quot;: &quot;main&quot;,
    &quot;kotlin-language-version-configured&quot;: &quot;true&quot;,
    &quot;last_opened_file_path&quot;: &quot;/Volumes/Files/Projects/newLoader/services/dataGenerator&quot;,
    &quot;node.js.detected.package.eslint&quot;: &quot;true&quot;,
    &quot;node.js.detected.package.tslint&quot;: &quot;true&quot;,
    &quot;node.js.selected.package.eslint&quot;: &quot;(autodetect)&quot;,
    &quot;node.js.selected.package.tslint&quot;: &quot;(autodetect)&quot;,
    &quot;nodejs_package_manager_path&quot;: &quot;npm&quot;,
    &quot;vue.rearranger.settings.migration&quot;: &quot;true&quot;
  }
}</component>
  <component name="RunManager">
    <configuration default="true" type="JetRunConfigurationType">
      <module name="dataGenerator" />
      <method v="2">
        <option name="Make" enabled="true" />
      </method>
    </configuration>
    <configuration name="DataGeneratorApplication" type="SpringBootApplicationConfigurationType" factoryName="Spring Boot" nameIsGenerated="true">
      <module name="data-generator" />
      <option name="SPRING_BOOT_MAIN_CLASS" value="com.loader.datagenerator.DataGeneratorApplication" />
      <method v="2">
        <option name="Make" enabled="true" />
      </method>
    </configuration>
  </component>
  <component name="SharedIndexes">
    <attachedChunks>
      <set>
        <option value="bundled-jdk-9823dce3aa75-28b599e66164-intellij.indexing.shared.core-IU-242.23339.11" />
        <option value="bundled-js-predefined-d6986cc7102b-5c90d61e3bab-JavaScript-IU-242.23339.11" />
      </set>
    </attachedChunks>
  </component>
  <component name="SpellCheckerSettings" RuntimeDictionaries="0" Folders="0" CustomDictionaries="0" DefaultDictionary="application-level" UseSingleDictionary="true" transferred="true" />
  <component name="TaskManager">
    <task active="true" id="Default" summary="Default task">
      <changelist id="0495c818-8a9d-4e15-bead-eef57ea7cb2a" name="Changes" comment="" />
      <created>1765967168460</created>
      <option name="number" value="Default" />
      <option name="presentableId" value="Default" />
      <updated>1765967168460</updated>
      <workItem from="1765967169508" duration="520000" />
      <workItem from="1765972724989" duration="2513000" />
    </task>
    <servers />
  </component>
  <component name="TypeScriptGeneratedFilesManager">
    <option name="version" value="3" />
  </component>
</project>
######################################################################################################################################################
#### end of file workspace.xml ####
#### end of file workspace.xml ####

# services/dataGenerator/.idea/misc.xml
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="ExternalStorageConfigurationManager" enabled="true" />
  <component name="MavenProjectsManager">
    <option name="originalFiles">
      <list>
        <option value="$PROJECT_DIR$/pom.xml" />
      </list>
    </option>
  </component>
  <component name="ProjectRootManager" version="2" languageLevel="JDK_23" default="true" project-jdk-name="23" project-jdk-type="JavaSDK" />
</project>
######################################################################################################################################################
#### end of file misc.xml ####
#### end of file misc.xml ####

# services/dataGenerator/.idea/compiler.xml
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CompilerConfiguration">
    <annotationProcessing>
      <profile name="Maven default annotation processors profile" enabled="true">
        <sourceOutputDir name="target/generated-sources/annotations" />
        <sourceTestOutputDir name="target/generated-test-sources/test-annotations" />
        <outputRelativeToContentRoot value="true" />
        <module name="data-generator" />
      </profile>
    </annotationProcessing>
  </component>
  <component name="JavacSettings">
    <option name="ADDITIONAL_OPTIONS_OVERRIDE">
      <module name="data-generator" options="-parameters" />
    </option>
  </component>
</project>
######################################################################################################################################################
#### end of file compiler.xml ####
#### end of file compiler.xml ####

# services/dataGenerator/src/.DS_Store
[SKIPPED: non-text or binary file]
######################################################################################################################################################
#### end of file .DS_Store ####
#### end of file .DS_Store ####

# services/dataGenerator/src/main/.DS_Store
[SKIPPED: non-text or binary file]
######################################################################################################################################################
#### end of file .DS_Store ####
#### end of file .DS_Store ####

# services/dataGenerator/src/main/resources/.DS_Store
[SKIPPED: non-text or binary file]
######################################################################################################################################################
#### end of file .DS_Store ####
#### end of file .DS_Store ####

# services/dataGenerator/src/main/resources/data-generator-config.yaml
# Test Data Generator Configuration
# DEV-ONLY: Defines tables, columns, data types, and generation rules

data-generator:
  mysql:
    host: ${MYSQL_HOST:mysql.loader-infra.svc.cluster.local}
    port: ${MYSQL_PORT:3306}
    database: ${MYSQL_DATABASE:testdata}
    user: ${MYSQL_USER:testuser}
    password: ${MYSQL_PASSWORD:testuser_password_dev}

  # Table definitions
  tables:
    # Example 1: Sales transactions
    - name: sales_data
      recordsPerMinute:
        min: 10
        max: 50
      columns:
        - name: transaction_id
          type: integer
          range: [1000, 999999]

        - name: amount
          type: float
          range: [10.0, 5000.0]
          precision: 2

        - name: product
          type: list
          values: ["Laptop", "Phone", "Tablet", "Monitor", "Keyboard", "Mouse", "Headphones", "Speaker"]

        - name: description
          type: random_text
          minLength: 10
          maxLength: 100

        - name: timestamp
          type: timestamp

    # Example 2: User activity
    - name: user_activity
      recordsPerMinute:
        min: 20
        max: 100
      columns:
        - name: user_id
          type: integer
          range: [1, 10000]

        - name: action
          type: list
          values: ["login", "logout", "view", "purchase", "add_to_cart", "search"]

        - name: session_duration
          type: integer
          range: [1, 3600]

        - name: timestamp
          type: timestamp

    # Example 3: Sensor readings
    - name: sensor_readings
      recordsPerMinute:
        min: 5
        max: 20
      columns:
        - name: sensor_id
          type: integer
          range: [1, 100]

        - name: temperature
          type: float
          range: [-20.0, 50.0]
          precision: 1

        - name: humidity
          type: float
          range: [0.0, 100.0]
          precision: 1

        - name: pressure
          type: float
          range: [900.0, 1100.0]
          precision: 2

        - name: location
          type: list
          values: ["Building-A", "Building-B", "Building-C", "Warehouse", "Lab"]

        - name: timestamp
          type: timestamp

  # Downtime simulation periods (optional)
  downtime:
    - start: "02:00"
      end: "02:15"
      reason: "Simulated nightly maintenance"

    - start: "14:30"
      end: "14:45"
      reason: "Simulated network issue"

######################################################################################################################################################
#### end of file data-generator-config.yaml ####
#### end of file data-generator-config.yaml ####

# services/dataGenerator/src/main/resources/application.yaml
spring:
  config:
     import: optional:classpath:data-generator-config.yaml
  application:
    name: data-generator

  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}

  # MySQL DataSource Configuration
  datasource:
    url: jdbc:mysql://${MYSQL_HOST:localhost}:${MYSQL_PORT:3306}/${MYSQL_DATABASE:testdata}?createDatabaseIfNotExist=true
    username: ${MYSQL_USER:testuser}
    password: ${MYSQL_PASSWORD:testuser_password_dev}
    driver-class-name: com.mysql.cj.jdbc.Driver

    # HikariCP settings
    hikari:
      maximum-pool-size: 10
      minimum-idle: 2
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

# Logging Configuration
logging:
  level:
    root: INFO
    com.loader.datagenerator: DEBUG
    org.springframework.jdbc: DEBUG
    org.springframework.jdbc.core.JdbcTemplate: TRACE
    org.springframework.scheduling: DEBUG
    com.zaxxer.hikari: DEBUG
    com.zaxxer.hikari.HikariConfig: DEBUG

# Data Generator Configuration (loaded from external config)
data-generator:
  mysql:
    host: ${MYSQL_HOST:localhost}
    port: ${MYSQL_PORT:3306}
    database: ${MYSQL_DATABASE:testdata}
    user: ${MYSQL_USER:testuser}
    password: ${MYSQL_PASSWORD:testuser_password_dev}

  # Tables configuration - will be overridden by config file
  tables: []

  # Downtime configuration - will be overridden by config file
  downtime: []

# Management endpoints
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: always

######################################################################################################################################################
#### end of file application.yaml ####
#### end of file application.yaml ####

# services/dataGenerator/src/main/java/com/loader/datagenerator/runner/SchemaInitializer.java
package com.loader.datagenerator.runner;

import com.loader.datagenerator.model.ColumnConfig;
import com.loader.datagenerator.model.DataGeneratorConfig;
import com.loader.datagenerator.model.TableConfig;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.ApplicationArguments;
import org.springframework.boot.ApplicationRunner;
import org.springframework.context.annotation.Profile;
import org.springframework.stereotype.Component;

import javax.sql.DataSource;
import java.sql.Connection;
import java.sql.Statement;

/**
 * Creates tables in MySQL based on configuration on startup
 *
 * <p>DEV-ONLY: Automatically creates table schemas from YAML configuration.</p>
 */
@Slf4j
@Component
@Profile("dev")
@RequiredArgsConstructor
public class SchemaInitializer implements ApplicationRunner {

    private final DataSource dataSource;
    private final DataGeneratorConfig config;

    @Override
    public void run(ApplicationArguments args) throws Exception {
        log.info("=== Initializing database schema ===");

        // Log JDBC connection details
        try (Connection conn = dataSource.getConnection()) {
            String jdbcUrl = conn.getMetaData().getURL();
            String username = conn.getMetaData().getUserName();
            String databaseProduct = conn.getMetaData().getDatabaseProductName();
            String databaseVersion = conn.getMetaData().getDatabaseProductVersion();

            log.info("JDBC URL: {}", jdbcUrl);
            log.info("Database User: {}", username);
            log.info("Database: {} {}", databaseProduct, databaseVersion);
        }

        log.info("Total tables to create: {}", config.getTables().size());

        if (config.getTables().isEmpty()) {
            log.warn("WARNING: No tables configured! Check data-generator.tables configuration.");
        }

        for (TableConfig table : config.getTables()) {
            createTableIfNotExists(table);
        }

        log.info("=== Database schema initialization completed ===");
    }

    private void createTableIfNotExists(TableConfig table) throws Exception {
        String createSql = buildCreateTableSql(table);

        log.info("Creating table '{}' with {} columns", table.getName(), table.getColumns().size());
        log.debug("SQL: {}", createSql);

        try (Connection conn = dataSource.getConnection();
             Statement stmt = conn.createStatement()) {

            stmt.execute(createSql);
            log.info("✓ Table '{}' created successfully or already exists", table.getName());
        }
    }

    private String buildCreateTableSql(TableConfig table) {
        StringBuilder sql = new StringBuilder("CREATE TABLE IF NOT EXISTS ");
        sql.append(table.getName()).append(" (\n");
        sql.append("  id BIGINT AUTO_INCREMENT PRIMARY KEY,\n");

        for (ColumnConfig column : table.getColumns()) {
            sql.append("  ").append(column.getName()).append(" ");

            switch (column.getType()) {
                case INTEGER:
                    sql.append("INT");
                    break;
                case FLOAT:
                    sql.append("DOUBLE");
                    break;
                case LIST:
                case RANDOM_TEXT:
                    sql.append("VARCHAR(255)");
                    break;
                case TIMESTAMP:
                    sql.append("TIMESTAMP DEFAULT CURRENT_TIMESTAMP");
                    break;
            }

            sql.append(",\n");
        }

        sql.append("  INDEX idx_timestamp (");
        // Find timestamp column and add index
        for (ColumnConfig column : table.getColumns()) {
            if (column.getType() == ColumnConfig.ColumnType.TIMESTAMP) {
                sql.append(column.getName());
                break;
            }
        }
        sql.append(")\n");

        sql.append(") ENGINE=InnoDB DEFAULT CHARSET=utf8mb4");

        return sql.toString();
    }
}

######################################################################################################################################################
#### end of file SchemaInitializer.java ####
#### end of file SchemaInitializer.java ####

# services/dataGenerator/src/main/java/com/loader/datagenerator/runner/ScheduledDataGenerator.java
package com.loader.datagenerator.runner;

import com.loader.datagenerator.service.DataGeneratorService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.context.annotation.Profile;
import org.springframework.scheduling.annotation.Scheduled;
import org.springframework.stereotype.Component;

/**
 * Scheduled runner to generate test data every minute
 *
 * <p>DEV-ONLY: Runs on a fixed rate to simulate continuous data ingestion.</p>
 */
@Slf4j
@Component
@Profile("dev")
@RequiredArgsConstructor
public class ScheduledDataGenerator {

    private final DataGeneratorService dataGeneratorService;

    /**
     * Generate and insert data every minute
     */
    @Scheduled(fixedRate = 60000, initialDelay = 10000)  // Every 60 seconds, start after 10 seconds
    public void generateData() {
        log.info("Starting scheduled data generation...");
        try {
            dataGeneratorService.generateAndInsertData();
            log.info("Scheduled data generation completed successfully");
        } catch (Exception e) {
            log.error("Scheduled data generation failed", e);
        }
    }
}

######################################################################################################################################################
#### end of file ScheduledDataGenerator.java ####
#### end of file ScheduledDataGenerator.java ####

# services/dataGenerator/src/main/java/com/loader/datagenerator/DataGeneratorApplication.java
package com.loader.datagenerator;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.boot.context.properties.ConfigurationPropertiesScan;
import org.springframework.context.annotation.Profile;
import org.springframework.scheduling.annotation.EnableScheduling;

/**
 * Test Data Generator Application
 *
 * <p>DEV-ONLY: Generates random test data and inserts into MySQL database
 * to simulate real production data for testing the ETL loader service.</p>
 *
 * <p>Features:
 * - Configurable table schemas via YAML
 * - Random data generation (integers, floats, lists, text)
 * - Configurable record insertion rate (records per minute)
 * - Downtime simulation periods
 * - JDBC-based insertion</p>
 *
 * <p>Only runs with Spring profile: dev</p>
 */
@SpringBootApplication
@EnableScheduling
@ConfigurationPropertiesScan
@Profile("dev")  // DEV-ONLY - will not start in production
public class DataGeneratorApplication {

    public static void main(String[] args) {
        SpringApplication.run(DataGeneratorApplication.class, args);
    }
}

######################################################################################################################################################
#### end of file DataGeneratorApplication.java ####
#### end of file DataGeneratorApplication.java ####

# services/dataGenerator/src/main/java/com/loader/datagenerator/model/DataGeneratorConfig.java
package com.loader.datagenerator.model;

import lombok.Data;
import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.stereotype.Component;

import java.util.List;

/**
 * Root configuration for test data generator
 */
@Data
@Component
@ConfigurationProperties(prefix = "data-generator")
public class DataGeneratorConfig {

    private MysqlConfig mysql;
    private List<TableConfig> tables;
    private List<DowntimeConfig> downtime;

    @Data
    public static class MysqlConfig {
        private String host;
        private Integer port;
        private String database;
        private String user;
        private String password;
    }
}

######################################################################################################################################################
#### end of file DataGeneratorConfig.java ####
#### end of file DataGeneratorConfig.java ####

# services/dataGenerator/src/main/java/com/loader/datagenerator/model/TableConfig.java
package com.loader.datagenerator.model;

import lombok.Data;

import java.util.List;

/**
 * Configuration for a single table to generate data for
 */
@Data
public class TableConfig {

    private String name;
    private RecordRateConfig recordsPerMinute;
    private List<ColumnConfig> columns;

    @Data
    public static class RecordRateConfig {
        private Integer min;
        private Integer max;
    }
}

######################################################################################################################################################
#### end of file TableConfig.java ####
#### end of file TableConfig.java ####

# services/dataGenerator/src/main/java/com/loader/datagenerator/model/DowntimeConfig.java
package com.loader.datagenerator.model;

import lombok.Data;

/**
 * Configuration for scheduled downtime periods (simulates system outages)
 */
@Data
public class DowntimeConfig {

    private String start;  // HH:mm format
    private String end;    // HH:mm format
    private String reason;
}

######################################################################################################################################################
#### end of file DowntimeConfig.java ####
#### end of file DowntimeConfig.java ####

# services/dataGenerator/src/main/java/com/loader/datagenerator/model/ColumnConfig.java
package com.loader.datagenerator.model;

import lombok.Data;

import java.util.List;

/**
 * Configuration for a single column in a table
 */
@Data
public class ColumnConfig {

    private String name;
    private ColumnType type;

    // For integer and float types
    private List<Number> range;  // [min, max]

    // For float type
    private Integer precision;

    // For list type
    private List<String> values;

    // For random_text type
    private Integer minLength;
    private Integer maxLength;

    public enum ColumnType {
        INTEGER,
        FLOAT,
        LIST,
        RANDOM_TEXT,
        TIMESTAMP
    }
}

######################################################################################################################################################
#### end of file ColumnConfig.java ####
#### end of file ColumnConfig.java ####

# services/dataGenerator/src/main/java/com/loader/datagenerator/service/DataGeneratorService.java
package com.loader.datagenerator.service;

import com.loader.datagenerator.model.ColumnConfig;
import com.loader.datagenerator.model.DataGeneratorConfig;
import com.loader.datagenerator.model.DowntimeConfig;
import com.loader.datagenerator.model.TableConfig;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.context.annotation.Profile;
import org.springframework.stereotype.Service;

import javax.sql.DataSource;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.SQLException;
import java.sql.Timestamp;
import java.time.LocalTime;
import java.time.format.DateTimeFormatter;
import java.util.List;
import java.util.Random;

/**
 * Service to generate random test data and insert via JDBC
 *
 * <p>DEV-ONLY: Generates random values based on column configuration
 * and inserts them into MySQL tables.</p>
 */
@Slf4j
@Service
@Profile("dev")
@RequiredArgsConstructor
public class DataGeneratorService {

    private final DataSource dataSource;
    private final DataGeneratorConfig config;
    private final Random random = new Random();

    private static final String RANDOM_TEXT_CHARS = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789 ";
    private static final DateTimeFormatter TIME_FORMATTER = DateTimeFormatter.ofPattern("HH:mm");

    /**
     * Check if current time is within any configured downtime period
     */
    public boolean isDowntime() {
        if (config.getDowntime() == null || config.getDowntime().isEmpty()) {
            return false;
        }

        LocalTime now = LocalTime.now();

        for (DowntimeConfig downtime : config.getDowntime()) {
            LocalTime start = LocalTime.parse(downtime.getStart(), TIME_FORMATTER);
            LocalTime end = LocalTime.parse(downtime.getEnd(), TIME_FORMATTER);

            if (now.isAfter(start) && now.isBefore(end)) {
                log.info("Currently in downtime period: {} - {} ({})",
                        downtime.getStart(), downtime.getEnd(), downtime.getReason());
                return true;
            }
        }

        return false;
    }

    /**
     * Generate and insert records for all configured tables
     */
    public void generateAndInsertData() {
        if (isDowntime()) {
            log.info("Skipping data generation due to downtime period");
            return;
        }

        log.info("=== Starting data generation for {} tables ===", config.getTables().size());

        if (config.getTables().isEmpty()) {
            log.warn("WARNING: No tables configured for data generation!");
            return;
        }

        int totalRecords = 0;
        for (TableConfig table : config.getTables()) {
            try {
                generateForTable(table);
                totalRecords++;
            } catch (Exception e) {
                log.error("Failed to generate data for table: {}", table.getName(), e);
            }
        }

        log.info("=== Data generation completed for {} tables ===", totalRecords);
    }

    /**
     * Generate and insert random records for a single table
     */
    private void generateForTable(TableConfig table) throws SQLException {
        // Determine number of records to insert this minute
        int min = table.getRecordsPerMinute().getMin();
        int max = table.getRecordsPerMinute().getMax();
        int recordCount = min + random.nextInt(max - min + 1);

        log.info("Generating {} records for table: {} (min={}, max={})", recordCount, table.getName(), min, max);

        // Build INSERT statement
        String sql = buildInsertSql(table);
        log.debug("INSERT SQL: {}", sql);

        try (Connection conn = dataSource.getConnection();
             PreparedStatement stmt = conn.prepareStatement(sql)) {

            for (int i = 0; i < recordCount; i++) {
                setStatementParameters(stmt, table.getColumns());
                stmt.addBatch();

                // Log first record as sample
                if (i == 0) {
                    log.debug("Sample record for '{}': {}", table.getName(), stmt.toString());
                }
            }

            long startTime = System.currentTimeMillis();
            int[] results = stmt.executeBatch();
            long duration = System.currentTimeMillis() - startTime;

            log.info("✓ Successfully inserted {} records into '{}' in {}ms", results.length, table.getName(), duration);
        }
    }

    /**
     * Build INSERT SQL statement for a table
     */
    private String buildInsertSql(TableConfig table) {
        StringBuilder sql = new StringBuilder("INSERT INTO ");
        sql.append(table.getName()).append(" (");

        // Column names
        for (int i = 0; i < table.getColumns().size(); i++) {
            if (i > 0) sql.append(", ");
            sql.append(table.getColumns().get(i).getName());
        }

        sql.append(") VALUES (");

        // Placeholders
        for (int i = 0; i < table.getColumns().size(); i++) {
            if (i > 0) sql.append(", ");
            sql.append("?");
        }

        sql.append(")");
        return sql.toString();
    }

    /**
     * Set prepared statement parameters with random values
     */
    private void setStatementParameters(PreparedStatement stmt, List<ColumnConfig> columns) throws SQLException {
        for (int i = 0; i < columns.size(); i++) {
            ColumnConfig column = columns.get(i);
            Object value = generateValue(column);

            int paramIndex = i + 1;

            switch (column.getType()) {
                case INTEGER:
                    stmt.setInt(paramIndex, (Integer) value);
                    break;
                case FLOAT:
                    stmt.setDouble(paramIndex, (Double) value);
                    break;
                case LIST:
                case RANDOM_TEXT:
                    stmt.setString(paramIndex, (String) value);
                    break;
                case TIMESTAMP:
                    stmt.setTimestamp(paramIndex, (Timestamp) value);
                    break;
            }
        }
    }

    /**
     * Generate a random value based on column configuration
     */
    private Object generateValue(ColumnConfig column) {
        switch (column.getType()) {
            case INTEGER:
                return generateInteger(column);
            case FLOAT:
                return generateFloat(column);
            case LIST:
                return generateFromList(column);
            case RANDOM_TEXT:
                return generateRandomText(column);
            case TIMESTAMP:
                return new Timestamp(System.currentTimeMillis());
            default:
                throw new IllegalArgumentException("Unsupported column type: " + column.getType());
        }
    }

    private Integer generateInteger(ColumnConfig column) {
        int min = column.getRange().get(0).intValue();
        int max = column.getRange().get(1).intValue();
        return min + random.nextInt(max - min + 1);
    }

    private Double generateFloat(ColumnConfig column) {
        double min = column.getRange().get(0).doubleValue();
        double max = column.getRange().get(1).doubleValue();
        double value = min + (max - min) * random.nextDouble();

        // Apply precision if specified
        if (column.getPrecision() != null) {
            double scale = Math.pow(10, column.getPrecision());
            value = Math.round(value * scale) / scale;
        }

        return value;
    }

    private String generateFromList(ColumnConfig column) {
        List<String> values = column.getValues();
        return values.get(random.nextInt(values.size()));
    }

    private String generateRandomText(ColumnConfig column) {
        int minLen = column.getMinLength();
        int maxLen = column.getMaxLength();
        int length = minLen + random.nextInt(maxLen - minLen + 1);

        StringBuilder text = new StringBuilder(length);
        for (int i = 0; i < length; i++) {
            text.append(RANDOM_TEXT_CHARS.charAt(random.nextInt(RANDOM_TEXT_CHARS.length())));
        }

        return text.toString().trim();
    }
}

######################################################################################################################################################
#### end of file DataGeneratorService.java ####
#### end of file DataGeneratorService.java ####

# .idea/stat.log
{"ts":1766148875619,"action":"PROJECT_OPENED","tags":{"PROJECT_NAME":"newLoader"}}
{"ts":1766148876566,"action":"FILE_OPENED","file":"/README.md","tags":{"FILE_LINE_OF_CODE":"431"}}
{"ts":1766148880508,"action":"IDE_DEACTIVATED"}
{"ts":1766148882965,"action":"IDE_ACTIVATED"}
{"ts":1766148884921,"action":"IDE_DEACTIVATED"}
{"ts":1766148885331,"action":"IDE_ACTIVATED"}
{"ts":1766148938945,"action":"IDE_DEACTIVATED"}
{"ts":1766148942856,"action":"IDE_ACTIVATED"}
{"ts":1766148946221,"action":"IDE_DEACTIVATED"}
{"ts":1766148948198,"action":"IDE_ACTIVATED"}
{"ts":1766148975148,"action":"IDE_DEACTIVATED"}
{"ts":1766149173179,"action":"IDE_ACTIVATED"}
{"ts":1766149206996,"action":"IDE_DEACTIVATED"}
{"ts":1766149216876,"action":"IDE_ACTIVATED"}
{"ts":1766149228701,"action":"PROJECT_CLOSED","tags":{"PROJECT_NAME":"newLoader"}}
{"ts":1766149266986,"action":"FILE_OPENED","file":"/README.md","tags":{"FILE_LINE_OF_CODE":"431"}}
{"ts":1766149266975,"action":"PROJECT_OPENED","tags":{"PROJECT_NAME":"newLoader"}}

######################################################################################################################################################
#### end of file stat.log ####
#### end of file stat.log ####

# .idea/encodings.xml
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="Encoding">
    <file url="file://$PROJECT_DIR$/services/dataGenerator/src/main/java" charset="UTF-8" />
  </component>
</project>
######################################################################################################################################################
#### end of file encodings.xml ####
#### end of file encodings.xml ####

# .idea/jarRepositories.xml
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="RemoteRepositoriesConfiguration">
    <remote-repository>
      <option name="id" value="central" />
      <option name="name" value="Central Repository" />
      <option name="url" value="https://repo.maven.apache.org/maven2" />
    </remote-repository>
    <remote-repository>
      <option name="id" value="central" />
      <option name="name" value="Maven Central repository" />
      <option name="url" value="https://repo1.maven.org/maven2" />
    </remote-repository>
    <remote-repository>
      <option name="id" value="jboss.community" />
      <option name="name" value="JBoss Community repository" />
      <option name="url" value="https://repository.jboss.org/nexus/content/repositories/public/" />
    </remote-repository>
  </component>
</project>
######################################################################################################################################################
#### end of file jarRepositories.xml ####
#### end of file jarRepositories.xml ####

# .idea/vcs.xml
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="VcsDirectoryMappings">
    <mapping directory="" vcs="Git" />
  </component>
</project>
######################################################################################################################################################
#### end of file vcs.xml ####
#### end of file vcs.xml ####

# .idea/.gitignore
# Default ignored files
/shelf/
/workspace.xml
# Editor-based HTTP Client requests
/httpRequests/
# Datasource local storage ignored files
/dataSources/
/dataSources.local.xml

######################################################################################################################################################
#### end of file .gitignore ####
#### end of file .gitignore ####

# .idea/workspace.xml
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="AutoImportSettings">
    <option name="autoReloadType" value="SELECTIVE" />
  </component>
  <component name="ChangeListManager">
    <list default="true" id="049b5f11-cf4f-4043-8d14-faadfff53e11" name="Changes" comment="">
      <change beforePath="$PROJECT_DIR$/README.md" beforeDir="false" afterPath="$PROJECT_DIR$/README.md" afterDir="false" />
      <change beforePath="$PROJECT_DIR$/infra/mysql/values-mysql.yaml" beforeDir="false" />
      <change beforePath="$PROJECT_DIR$/infra/secrets/monitoring-secrets-sealed.yaml" beforeDir="false" afterPath="$PROJECT_DIR$/infra/secrets/monitoring-secrets-sealed.yaml" afterDir="false" />
    </list>
    <option name="SHOW_DIALOG" value="false" />
    <option name="HIGHLIGHT_CONFLICTS" value="true" />
    <option name="HIGHLIGHT_NON_ACTIVE_CHANGELIST" value="false" />
    <option name="LAST_RESOLUTION" value="IGNORE" />
  </component>
  <component name="Git.Settings">
    <option name="RECENT_GIT_ROOT_PATH" value="$PROJECT_DIR$" />
  </component>
  <component name="GitHubPullRequestSearchHistory"><![CDATA[{
  "lastFilter": {
    "state": "OPEN",
    "assignee": "hrawashdeh"
  }
}]]></component>
  <component name="GithubPullRequestsUISettings"><![CDATA[{
  "selectedUrlAndAccountId": {
    "url": "https://github.com/hrawashdeh/newMonitoring.git",
    "accountId": "cf0b02f8-3d61-4d1f-aa0d-c6209cc2ae6b"
  }
}]]></component>
  <component name="KubernetesApiPersistence"><![CDATA[{}]]></component>
  <component name="KubernetesApiProvider"><![CDATA[{
  "configuredContexts": [
    {
      "name": "docker-desktop",
      "kubeConfigUrl": "file:///Users/hassanrawashdeh/.kube/config"
    }
  ],
  "isMigrated": true
}]]></component>
  <component name="ProjectColorInfo"><![CDATA[{
  "associatedIndex": 0
}]]></component>
  <component name="ProjectId" id="3744BcnleawZMMiMQVJoUC2M6Wi" />
  <component name="ProjectViewState">
    <option name="hideEmptyMiddlePackages" value="true" />
    <option name="showLibraryContents" value="true" />
  </component>
  <component name="PropertiesComponent"><![CDATA[{
  "keyToString": {
    "RunOnceActivity.ShowReadmeOnStart": "true",
    "git-widget-placeholder": "main",
    "kotlin-language-version-configured": "true",
    "last_opened_file_path": "/Volumes/Files/Projects/newLoader",
    "node.js.detected.package.eslint": "true",
    "node.js.detected.package.tslint": "true",
    "node.js.selected.package.eslint": "(autodetect)",
    "node.js.selected.package.tslint": "(autodetect)",
    "nodejs_package_manager_path": "npm",
    "settings.editor.selected.configurable": "reference.settings.project.maven.importing",
    "vue.rearranger.settings.migration": "true"
  }
}]]></component>
  <component name="RunManager">
    <configuration name="DataGeneratorApplication" type="SpringBootApplicationConfigurationType" factoryName="Spring Boot" nameIsGenerated="true">
      <module name="data-generator" />
      <option name="SPRING_BOOT_MAIN_CLASS" value="com.loader.datagenerator.DataGeneratorApplication" />
      <method v="2">
        <option name="Make" enabled="true" />
      </method>
    </configuration>
  </component>
  <component name="SharedIndexes">
    <attachedChunks>
      <set>
        <option value="bundled-jdk-9823dce3aa75-28b599e66164-intellij.indexing.shared.core-IU-242.23339.11" />
        <option value="bundled-js-predefined-d6986cc7102b-5c90d61e3bab-JavaScript-IU-242.23339.11" />
      </set>
    </attachedChunks>
  </component>
  <component name="SpellCheckerSettings" RuntimeDictionaries="0" Folders="0" CustomDictionaries="0" DefaultDictionary="application-level" UseSingleDictionary="true" transferred="true" />
  <component name="TaskManager">
    <task active="true" id="Default" summary="Default task">
      <changelist id="049b5f11-cf4f-4043-8d14-faadfff53e11" name="Changes" comment="" />
      <created>1766148875666</created>
      <option name="number" value="Default" />
      <option name="presentableId" value="Default" />
      <updated>1766148875666</updated>
      <workItem from="1766148876641" duration="352000" />
    </task>
    <servers />
  </component>
  <component name="TypeScriptGeneratedFilesManager">
    <option name="version" value="3" />
  </component>
</project>
######################################################################################################################################################
#### end of file workspace.xml ####
#### end of file workspace.xml ####

# .idea/modules.xml
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="ProjectModuleManager">
    <modules>
      <module fileurl="file://$PROJECT_DIR$/.idea/newLoader.iml" filepath="$PROJECT_DIR$/.idea/newLoader.iml" />
    </modules>
  </component>
</project>
######################################################################################################################################################
#### end of file modules.xml ####
#### end of file modules.xml ####

# .idea/newLoader.iml
<?xml version="1.0" encoding="UTF-8"?>
<module type="JAVA_MODULE" version="4">
  <component name="NewModuleRootManager" inherit-compiler-output="true">
    <exclude-output />
    <content url="file://$MODULE_DIR$" />
    <orderEntry type="inheritedJdk" />
    <orderEntry type="sourceFolder" forTests="false" />
  </component>
</module>
######################################################################################################################################################
#### end of file newLoader.iml ####
#### end of file newLoader.iml ####

# .idea/misc.xml
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="ExternalStorageConfigurationManager" enabled="true" />
  <component name="MavenProjectsManager">
    <option name="originalFiles">
      <list>
        <option value="$PROJECT_DIR$/services/dataGenerator/pom.xml" />
      </list>
    </option>
  </component>
  <component name="ProjectRootManager" version="2" languageLevel="JDK_23" default="true" project-jdk-name="23" project-jdk-type="JavaSDK">
    <output url="file://$PROJECT_DIR$/out" />
  </component>
</project>
######################################################################################################################################################
#### end of file misc.xml ####
#### end of file misc.xml ####

# .idea/compiler.xml
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CompilerConfiguration">
    <annotationProcessing>
      <profile name="Maven default annotation processors profile" enabled="true">
        <sourceOutputDir name="target/generated-sources/annotations" />
        <sourceTestOutputDir name="target/generated-test-sources/test-annotations" />
        <outputRelativeToContentRoot value="true" />
        <module name="data-generator" />
      </profile>
    </annotationProcessing>
  </component>
  <component name="JavacSettings">
    <option name="ADDITIONAL_OPTIONS_OVERRIDE">
      <module name="data-generator" options="-parameters" />
    </option>
  </component>
</project>
######################################################################################################################################################
#### end of file compiler.xml ####
#### end of file compiler.xml ####

