spring:
  datasource:
    # DEV PROFILE - FOR LOCAL DEVELOPMENT ONLY
    # These are default values for local development
    # Override with environment variables or command-line args:
    #   export SPRING_DATASOURCE_URL=''
    #   export SPRING_DATASOURCE_USERNAME=''
    #   export SPRING_DATASOURCE_PASSWORD=''
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://1.2.3.4:5433/alerts}
    username: ${SPRING_DATASOURCE_USERNAME:a}
    password: ${SPRING_DATASOURCE_PASSWORD:a}
    driver-class-name: org.postgresql.Driver

  jpa:
    hibernate:
      ddl-auto: create-drop
    properties:
      hibernate.dialect: org.hibernate.dialect.PostgreSQLDialect
      hibernate.hbm2ddl.create_namespaces: false
    defer-datasource-initialization: true  # run data-dev.sql AFTER DDL

  sql:
    init:
      mode: always
      # data-locations: classpath:data-dev.sql  # Disabled: Using DevDataLoader component for encrypted fields
      # schema-locations: classpath:schema-dev.sql  # Disabled: Using Hibernate DDL (create-drop) to generate schema from JPA entities

  servlet:
    multipart:
      max-file-size: 10MB          # Maximum file size for uploads
      max-request-size: 10MB       # Maximum request size (file + metadata)

# Encryption key for local development
# SECURITY: This is a DEV-ONLY key. Generate new key for production with: openssl rand -base64 32
encryption:
  key: ${ENCRYPTION_KEY:e2mWpFHBa3+3DRfZtaNCADsy3E7FArTZ2RFGCRsxod4=}

# JWT Configuration for authentication
# SECURITY: This is a DEV-ONLY secret. Generate new secret for production with: openssl rand -base64 32
jwt:
  secret: ${JWT_SECRET:devSecretKeyForJwtTokenGenerationMustBeAtLeast256BitsLongForHmacSha256Algorithm}
  expiration-ms: ${JWT_EXPIRATION_MS:86400000}  # 24 hours (86400000 ms)

# Max HTTP request payload size (protect against DoS attacks)
server:
  tomcat:
    max-http-form-post-size: 10MB  # Maximum size for form POST data
    max-swallow-size: 10MB         # Maximum size of request body to swallow
  max-http-request-header-size: 64KB  # Maximum size for HTTP request headers

# Loader configuration
loader:
  # Replica name for distributed execution tracking
  # Optional: Override for local development (default: HOSTNAME env var)
  # replica-name: dev-laptop-john
  replica-name: ${LOADER_REPLICA_NAME:#{null}}

logging:
  level:
    org.hibernate.show_sql: DEBUG
    format_sql: DEBUG
    highlight_sql: DEBUG
    org.hibernate.SQL: DEBUG           # Logs all SQL statements generated by Hibernate
    org.hibernate.orm.jdbc.bind: TRACE # Logs bound parameters for SQL statements
    org.springframework.jdbc.core: DEBUG  # Logs JDBC operations (PreparedStatement, queries, etc.)
    org.springframework.jdbc.datasource: DEBUG
    com.zaxxer.hikari.HikariConfig: DEBUG # Logs HikariCP connection pool actions
    com.zaxxer.hikari: TRACE
# application.yaml (or application-dev.yaml)
sources:
  mysql:
    pool:
      minimumIdle: 1
      maximumPoolSize: 5
      idleTimeoutMs: 300000     # 5 min
      connectionTimeoutMs: 30000
      leakDetectionThresholdMs: 0   # set >0 only for debugging leaks
