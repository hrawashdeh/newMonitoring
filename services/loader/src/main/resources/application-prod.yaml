# Production Profile Configuration
# This profile is used in Kubernetes/Docker deployments
# All sensitive values MUST come from environment variables (Sealed Secrets in K8s)

spring:
  datasource:
    # REQUIRED: Must be provided via environment variables
    # In Kubernetes: These come from sealed-secret.yaml -> loader-secret
    # In Docker: Must be set before running container
    url: ${SPRING_DATASOURCE_URL}
    username: ${SPRING_DATASOURCE_USERNAME}
    password: ${SPRING_DATASOURCE_PASSWORD}
    driver-class-name: org.postgresql.Driver

  # Redis for centralized API configuration
  data:
    redis:
      host: ${REDIS_HOST:redis-master.monitoring-infra.svc.cluster.local}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      timeout: 5000

  jpa:
    hibernate:
      # IMPORTANT: Schema created by DDL scripts, not Hibernate
      ddl-auto: none
    properties:
      hibernate.dialect: org.hibernate.dialect.PostgreSQLDialect
      hibernate.hbm2ddl.create_namespaces: false
    show-sql: false  # Disable SQL logging in production

  # Flyway DISABLED - using DDL scripts + etl_initializer service instead
  flyway:
    enabled: false

  sql:
    init:
      # IMPORTANT: Disable data initialization in production
      mode: never

# Loader configuration
loader:
  # Replica name for distributed execution tracking
  # In Kubernetes: Uses HOSTNAME env var (automatically set to pod name)
  # Override only if needed: LOADER_REPLICA_NAME environment variable
  replica-name: ${LOADER_REPLICA_NAME:#{null}}

# Production logging - INFO level only
logging:
  level:
    root: INFO
    com.tiqmo.monitoring.loader: INFO
    org.hibernate: WARN
    org.springframework: WARN
    com.zaxxer.hikari: WARN

# API Configuration
api:
  config:
    service-id: ldr
  gateway:
    base-url: ${API_GATEWAY_URL:http://gateway.monitoring-app.svc.cluster.local:8080}

# MySQL source pool configuration (can be overridden via env vars)
sources:
  mysql:
    pool:
      minimumIdle: ${SOURCES_MYSQL_POOL_MINIMUM_IDLE:2}
      maximumPoolSize: ${SOURCES_MYSQL_POOL_MAXIMUM_POOL_SIZE:10}
      idleTimeoutMs: ${SOURCES_MYSQL_POOL_IDLE_TIMEOUT:600000}        # 10 min
      connectionTimeoutMs: ${SOURCES_MYSQL_POOL_CONNECTION_TIMEOUT:30000}
      leakDetectionThresholdMs: ${SOURCES_MYSQL_POOL_LEAK_DETECTION:0}
